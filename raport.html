<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl-PL" xml:lang="pl-PL"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zespół Analiz Biznesowych Space-U:">
<meta name="author" content="Jakub Ciągło">
<meta name="author" content="Mateusz Ćwiek">
<meta name="author" content="Marek Dworaczyk">
<meta name="author" content="Rafał Głodek">

<title>Gwiezdne Horyzonty 2125</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="raport_files/libs/clipboard/clipboard.min.js"></script>
<script src="raport_files/libs/quarto-html/quarto.js"></script>
<script src="raport_files/libs/quarto-html/popper.min.js"></script>
<script src="raport_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="raport_files/libs/quarto-html/anchor.min.js"></script>
<link href="raport_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="raport_files/libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="raport_files/libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="raport_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="raport_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="raport_files/libs/bootstrap/bootstrap-eef6f51fcc05e63751d4150fde7d63e2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="raport_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Spis treści</h2>
   
  <ul>
  <li><a href="#wstęp" id="toc-wstęp" class="nav-link active" data-scroll-target="#wstęp">Wstęp</a></li>
  <li><a href="#analiza-danych" id="toc-analiza-danych" class="nav-link" data-scroll-target="#analiza-danych">Analiza danych</a>
  <ul class="collapse">
  <li><a href="#analiza-rentowności-i-popularności-wypraw" id="toc-analiza-rentowności-i-popularności-wypraw" class="nav-link" data-scroll-target="#analiza-rentowności-i-popularności-wypraw">Analiza rentowności i popularności wypraw</a>
  <ul class="collapse">
  <li><a href="#liderzy-popularności" id="toc-liderzy-popularności" class="nav-link" data-scroll-target="#liderzy-popularności">Liderzy Popularności</a></li>
  <li><a href="#analiza-rentowności" id="toc-analiza-rentowności" class="nav-link" data-scroll-target="#analiza-rentowności">Analiza Rentowności</a></li>
  </ul></li>
  <li><a href="#analiza-dynamiki-bazy-klientów" id="toc-analiza-dynamiki-bazy-klientów" class="nav-link" data-scroll-target="#analiza-dynamiki-bazy-klientów">Analiza Dynamiki Bazy Klientów</a></li>
  <li><a href="#analiza-ryzyka-operacyjnego" id="toc-analiza-ryzyka-operacyjnego" class="nav-link" data-scroll-target="#analiza-ryzyka-operacyjnego">Analiza ryzyka operacyjnego</a>
  <ul class="collapse">
  <li><a href="#ryzyko-związane-z-destynacja" id="toc-ryzyko-związane-z-destynacja" class="nav-link" data-scroll-target="#ryzyko-związane-z-destynacja">Ryzyko związane z destynacja</a></li>
  <li><a href="#ryzyko-związane-ze-sprzętem" id="toc-ryzyko-związane-ze-sprzętem" class="nav-link" data-scroll-target="#ryzyko-związane-ze-sprzętem">Ryzyko związane ze sprzętem</a></li>
  </ul></li>
  <li><a href="#wpływ-incydentów-na-satysfakcję-klienta" id="toc-wpływ-incydentów-na-satysfakcję-klienta" class="nav-link" data-scroll-target="#wpływ-incydentów-na-satysfakcję-klienta">Wpływ incydentów na satysfakcję klienta</a></li>
  <li><a href="#głos-klienta---analiza-ocen-wypraw" id="toc-głos-klienta---analiza-ocen-wypraw" class="nav-link" data-scroll-target="#głos-klienta---analiza-ocen-wypraw">Głos klienta - analiza ocen wypraw</a>
  <ul class="collapse">
  <li><a href="#ranking-ocen-destynacji" id="toc-ranking-ocen-destynacji" class="nav-link" data-scroll-target="#ranking-ocen-destynacji">Ranking ocen destynacji</a></li>
  <li><a href="#ranking-ocen-rodzajów-wypraw" id="toc-ranking-ocen-rodzajów-wypraw" class="nav-link" data-scroll-target="#ranking-ocen-rodzajów-wypraw">Ranking ocen rodzajów wypraw</a></li>
  </ul></li>
  <li><a href="#profil-demograficzny-klientów---analiza-wieku" id="toc-profil-demograficzny-klientów---analiza-wieku" class="nav-link" data-scroll-target="#profil-demograficzny-klientów---analiza-wieku">Profil demograficzny klientów - analiza wieku</a></li>
  <li><a href="#segmentacja-klientów-metodą-rfm" id="toc-segmentacja-klientów-metodą-rfm" class="nav-link" data-scroll-target="#segmentacja-klientów-metodą-rfm">Segmentacja klientów metodą RFM</a>
  <ul class="collapse">
  <li><a href="#rozkład-klientów-w-segmentach-rfm" id="toc-rozkład-klientów-w-segmentach-rfm" class="nav-link" data-scroll-target="#rozkład-klientów-w-segmentach-rfm">Rozkład klientów w segmentach RFM</a></li>
  </ul></li>
  <li><a href="#wyprawy-odpychające-i-przyciągające" id="toc-wyprawy-odpychające-i-przyciągające" class="nav-link" data-scroll-target="#wyprawy-odpychające-i-przyciągające">Wyprawy odpychające i przyciągające</a></li>
  <li><a href="#odnalezienie-najlepiej-ocenianego-oraz-najaktywniejszego-pracownika" id="toc-odnalezienie-najlepiej-ocenianego-oraz-najaktywniejszego-pracownika" class="nav-link" data-scroll-target="#odnalezienie-najlepiej-ocenianego-oraz-najaktywniejszego-pracownika">Odnalezienie najlepiej ocenianego oraz najaktywniejszego pracownika</a></li>
  <li><a href="#roczna-sezonowość-wypraw-i-incydentów." id="toc-roczna-sezonowość-wypraw-i-incydentów." class="nav-link" data-scroll-target="#roczna-sezonowość-wypraw-i-incydentów.">Roczna sezonowość wypraw i incydentów.</a></li>
  <li><a href="#czy-klienci-dokonują-płatności-za-przejazdy-z-wyprzedzeniem-czy-czekają-do-ostatniej-chwili" id="toc-czy-klienci-dokonują-płatności-za-przejazdy-z-wyprzedzeniem-czy-czekają-do-ostatniej-chwili" class="nav-link" data-scroll-target="#czy-klienci-dokonują-płatności-za-przejazdy-z-wyprzedzeniem-czy-czekają-do-ostatniej-chwili">Czy klienci dokonują płatności za przejazdy z wyprzedzeniem, czy czekają do ostatniej chwili?</a></li>
  <li><a href="#ulubione-metody-płatności-naszych-klientów.-z-jakiego-źródła-wpływa-najwięcej-pieniędzy." id="toc-ulubione-metody-płatności-naszych-klientów.-z-jakiego-źródła-wpływa-najwięcej-pieniędzy." class="nav-link" data-scroll-target="#ulubione-metody-płatności-naszych-klientów.-z-jakiego-źródła-wpływa-najwięcej-pieniędzy.">Ulubione metody płatności naszych klientów. Z jakiego źródła wpływa najwięcej pieniędzy.</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Gwiezdne Horyzonty 2125</h1>
<p class="subtitle lead">Roczna Analiza Strategiczna Space-U</p>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Autorzy</div>
    <div class="quarto-title-meta-contents">
             <p><strong>Zespół Analiz Biznesowych Space-U:</strong> </p>
             <p><span style="font-size: 0.9em; color: #7f8c8d;">Jakub Ciągło</span> </p>
             <p><span style="font-size: 0.9em; color: #7f8c8d;">Mateusz Ćwiek</span> </p>
             <p><span style="font-size: 0.9em; color: #7f8c8d;">Marek Dworaczyk</span> </p>
             <p><span style="font-size: 0.9em; color: #7f8c8d;">Rafał Głodek</span> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Opublikowano</div>
    <div class="quarto-title-meta-contents">
      <p class="date">13 czerwca 2125</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="wstęp" class="level1">
<h1>Wstęp</h1>
<p>W bezkresie kosmosu, podobnie jak w oceanie danych, kluczem do sukcesu jest precyzyjna nawigacja. Od ponad dekady misją Space-U jest nie tylko otwieranie ludzkości drogi do gwiazd, ale również prowadzenie tej ekspansji w sposób mądry, zrównoważony i rentowny. Poprzedni rok był kolejnym kamieniem milowym na naszej orbicie sukcesu – rokiem, w którym umocniliśmy naszą pozycję lidera, wysłaliśmy rekordową liczbę pasażerów ku czerwonym piaskom Marsa i zorzom Jowisza, ale także zmierzyliśmy się z nowymi, nieprzewidzianymi wyzwaniami.</p>
<p>Niniejszy raport jest naszą mapą nawigacyjną po historii działalności naszej firmy. Z kosmiczną precyzją przeanalizowaliśmy zebrane dane, aby odpowiedzieć na fundamentalne pytania. Które trajektorie lotów przynoszą największe zyski? Jak zmienia się profil demograficzny naszych międzyplanetarnych podróżników? Gdzie leżą ukryte ryzyka operacyjne – czy to w pasie asteroid, czy w awaryjności naszych statków? I wreszcie – jak odczucia i oceny naszych klientów korelują z incydentami napotkanymi w drodze na orbitę?</p>
<p>Celem tego dokumentu nie jest jedynie kronikarski zapis przeszłości. To przede wszystkim kompas, który ma wskazać kierunek przyszłych działań. Wnioski tu zawarte stanowią solidny, oparty na twardych danych fundament pod strategiczne decyzje, które wyznaczą kurs Space-U na kolejne lata. Informacje te pozwolą nam nie tylko optymalizować obecne operacje, ale także odkrywać zupełnie nowe konstelacje możliwości rynkowych.</p>
<p>Zapnijcie pasy. Wyruszamy w podróż po danych, która ukształtuje przyszłość międzyplanetarnych podróży.</p>
</section>
<section id="analiza-danych" class="level1">
<h1>Analiza danych</h1>
<section id="analiza-rentowności-i-popularności-wypraw" class="level2">
<h2 class="anchored" data-anchor-id="analiza-rentowności-i-popularności-wypraw">Analiza rentowności i popularności wypraw</h2>
<p>W tej kluczowej sekcji raportu dokonujemy szczegółowego przeglądu naszego portfolio usług. Naszym celem jest precyzyjne zidentyfikowanie, które rodzaje wypraw stanowią trzon naszej oferty – ciesząc się największym zainteresowaniem klientów – oraz, co najważniejsze, jak popularność ta przekłada się na wyniki finansowe. Zrozumienie rentowności poszczególnych “produktów” jest fundamentem do podejmowania świadomych decyzji o alokacji zasobów, strategii cenowej i przyszłych inwestycjach w rozwój floty oraz nowych tras.</p>
<p>Analiza została przeprowadzona na podstawie pełnych danych operacyjnych i finansowych z pięciu lat działalności naszej firmy. Wykorzystaliśmy do tego bezpośrednie zapytanie do naszej centralnej bazy danych, agregując informacje o liczbie lotów, całkowitych kosztach misji oraz skompletowanych transakcjach.</p>
<div id="06ab1506" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">    tt.name AS 'Rodzaj wyprawy',</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(t.trip_id) AS 'Liczba wypraw',</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(SUM(ac.total_trip_cost), 0) AS 'Całkowite koszty',</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(SUM(ar.total_trip_revenue), 0) AS 'Całkowite przychody',</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">    (COALESCE(SUM(ar.total_trip_revenue), 0) - COALESCE(SUM(ac.total_trip_cost), 0)) AS 'Zysk'</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">    trip_types tt</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">    trips t ON tt.trip_type_id = t.trip_type_id</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">    (SELECT trip_id, SUM(cost_amount) AS total_trip_cost FROM costs GROUP BY trip_id) ac </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">    ON t.trip_id = ac.trip_id</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">    (SELECT trip_id, SUM(amount) AS total_trip_revenue FROM transactions WHERE status = 'Completed' GROUP BY trip_id) ar </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">    ON t.trip_id = ar.trip_id</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="st">    tt.name</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="st">    `Liczba wypraw` DESC;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Poniższa tabela prezentuje kompleksowe zestawienie kluczowych wskaźników dla każdego typu wyprawy</p>
<div id="7983cc58" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_profitability <span class="op">=</span> pd.read_sql(query, engine)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>display(df_profitability.style.<span class="bu">format</span>(<span class="st">'</span><span class="sc">{:,.2f}</span><span class="st"> zł'</span>, subset<span class="op">=</span>[<span class="st">'Całkowite koszty'</span>, <span class="st">'Całkowite przychody'</span>, <span class="st">'Zysk'</span>], decimal<span class="op">=</span><span class="st">','</span>, thousands<span class="op">=</span><span class="st">' '</span>)<span class="op">\</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                         .<span class="bu">format</span>(<span class="st">'</span><span class="sc">{}</span><span class="st">'</span>, subset<span class="op">=</span>[<span class="st">'Liczba wypraw'</span>])<span class="op">\</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                         .set_caption(<span class="st">"Popularność i rentowność typów wypraw"</span>)<span class="op">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                         .background_gradient(cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, subset<span class="op">=</span>[<span class="st">'Zysk'</span>]))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_f4060_row0_col4 {
  background-color: #feec9f;
  color: #000000;
}
#T_f4060_row1_col4 {
  background-color: #fb9d59;
  color: #000000;
}
#T_f4060_row2_col4 {
  background-color: #6ec064;
  color: #000000;
}
#T_f4060_row3_col4 {
  background-color: #006837;
  color: #f1f1f1;
}
#T_f4060_row4_col4 {
  background-color: #f67f4b;
  color: #f1f1f1;
}
#T_f4060_row5_col4 {
  background-color: #fdbd6d;
  color: #000000;
}
#T_f4060_row6_col4 {
  background-color: #f67a49;
  color: #f1f1f1;
}
#T_f4060_row7_col4 {
  background-color: #a50026;
  color: #f1f1f1;
}
</style>

<div id="T_f4060" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_f4060-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;1: Popularność i rentowność typów wypraw
</figcaption>
<div aria-describedby="T_f4060-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_f4060" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_f4060_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Rodzaj wyprawy</th>
<th id="T_f4060_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Liczba wypraw</th>
<th id="T_f4060_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Całkowite koszty</th>
<th id="T_f4060_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Całkowite przychody</th>
<th id="T_f4060_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Zysk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_f4060_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_f4060_row0_col0" class="data row0 col0">Eksploracja Magnetosfery</td>
<td id="T_f4060_row0_col1" class="data row0 col1">17</td>
<td id="T_f4060_row0_col2" class="data row0 col2">134 990 866,07 zł</td>
<td id="T_f4060_row0_col3" class="data row0 col3">5 989 266 035,38 zł</td>
<td id="T_f4060_row0_col4" class="data row0 col4">5 854 275 169,31 zł</td>
</tr>
<tr class="even">
<td id="T_f4060_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_f4060_row1_col0" class="data row1 col0">Wycieczka Orbitalna</td>
<td id="T_f4060_row1_col1" class="data row1 col1">16</td>
<td id="T_f4060_row1_col2" class="data row1 col2">101 059 194,93 zł</td>
<td id="T_f4060_row1_col3" class="data row1 col3">4 574 280 250,41 zł</td>
<td id="T_f4060_row1_col4" class="data row1 col4">4 473 221 055,48 zł</td>
</tr>
<tr class="odd">
<td id="T_f4060_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_f4060_row2_col0" class="data row2 col0">Widokowe Obserwacje Nieba</td>
<td id="T_f4060_row2_col1" class="data row2 col1">15</td>
<td id="T_f4060_row2_col2" class="data row2 col2">190 167 301,05 zł</td>
<td id="T_f4060_row2_col3" class="data row2 col3">9 026 353 140,77 zł</td>
<td id="T_f4060_row2_col4" class="data row2 col4">8 836 185 839,72 zł</td>
</tr>
<tr class="even">
<td id="T_f4060_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_f4060_row3_col0" class="data row3 col0">Baza Kosmiczna - Pobyt</td>
<td id="T_f4060_row3_col1" class="data row3 col1">14</td>
<td id="T_f4060_row3_col2" class="data row3 col2">239 886 128,24 zł</td>
<td id="T_f4060_row3_col3" class="data row3 col3">10 882 734 008,31 zł</td>
<td id="T_f4060_row3_col4" class="data row3 col4">10 642 847 880,07 zł</td>
</tr>
<tr class="odd">
<td id="T_f4060_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_f4060_row4_col0" class="data row4 col0">Przygoda Atmosferyczna</td>
<td id="T_f4060_row4_col1" class="data row4 col1">11</td>
<td id="T_f4060_row4_col2" class="data row4 col2">83 478 430,60 zł</td>
<td id="T_f4060_row4_col3" class="data row4 col3">4 152 950 556,94 zł</td>
<td id="T_f4060_row4_col4" class="data row4 col4">4 069 472 126,34 zł</td>
</tr>
<tr class="even">
<td id="T_f4060_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</td>
<td id="T_f4060_row5_col0" class="data row5 col0">Przelot Przez Pole Promieniowania</td>
<td id="T_f4060_row5_col1" class="data row5 col1">10</td>
<td id="T_f4060_row5_col2" class="data row5 col2">100 898 382,92 zł</td>
<td id="T_f4060_row5_col3" class="data row5 col3">5 016 899 656,50 zł</td>
<td id="T_f4060_row5_col4" class="data row5 col4">4 916 001 273,58 zł</td>
</tr>
<tr class="odd">
<td id="T_f4060_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</td>
<td id="T_f4060_row6_col0" class="data row6 col0">Wyprawa Powierzchniowa</td>
<td id="T_f4060_row6_col1" class="data row6 col1">9</td>
<td id="T_f4060_row6_col2" class="data row6 col2">92 595 250,15 zł</td>
<td id="T_f4060_row6_col3" class="data row6 col3">4 096 970 926,91 zł</td>
<td id="T_f4060_row6_col4" class="data row6 col4">4 004 375 676,76 zł</td>
</tr>
<tr class="even">
<td id="T_f4060_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</td>
<td id="T_f4060_row7_col0" class="data row7 col0">Manewry Orbitalne</td>
<td id="T_f4060_row7_col1" class="data row7 col1">8</td>
<td id="T_f4060_row7_col2" class="data row7 col2">51 021 820,33 zł</td>
<td id="T_f4060_row7_col3" class="data row7 col3">2 158 121 105,26 zł</td>
<td id="T_f4060_row7_col4" class="data row7 col4">2 107 099 284,93 zł</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<div id="a949b0ba" class="cell" data-execution_count="6">
<section id="liderzy-popularności" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="liderzy-popularności">Liderzy Popularności</h3>
Nasze dane jednoznacznie wskazują na grupę flagowych produktów, które stanowią o sile naszej marki. Poniżej przedstawiamy TOP 3 najchętniej wybieranych wypraw:
<ul>
<li>
<b>Eksploracja Magnetosfery</b>: zrealizowano <b>17</b> wypraw, które przyniosły <b>5,989,266,035.38 zł</b> przychodu.
</li>
<li>
<b>Wycieczka Orbitalna</b>: zrealizowano <b>16</b> wypraw, które przyniosły <b>4,574,280,250.41 zł</b> przychodu.
</li>
<li>
<b>Widokowe Obserwacje Nieba</b>: zrealizowano <b>15</b> wypraw, które przyniosły <b>9,026,353,140.77 zł</b> przychodu.
</li>
</ul>
</section>
</div>
<div id="aefe93b0" class="cell" data-execution_count="7">
<section id="analiza-rentowności" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="analiza-rentowności">Analiza Rentowności</h3>
<p style="color: #198754;">
<b>Doskonałe wieści:</b> W analizowanym okresie wszystkie oferowane przez Space-U rodzaje wypraw okazały się rentowne. To świadczy o zdrowej strukturze kosztów i dobrze skalibrowanej polityce cenowej.
</p>
</section>
</div>
</section>
<section id="analiza-dynamiki-bazy-klientów" class="level2">
<h2 class="anchored" data-anchor-id="analiza-dynamiki-bazy-klientów">Analiza Dynamiki Bazy Klientów</h2>
<p>Analiza miesięcznej liczby obsłużonych klientów jest jednym z fundamentalnych wskaźników kondycji i tempa rozwoju Space-U. To część naszej działalności, która pozwala ocenić skuteczność naszych działań marketingowych, atrakcyjność oferty oraz ogólne zainteresowanie podróżami kosmicznymi. W tej sekcji zbadamy, czy w ostatnich latach nasza firma znajdowała się na trajektorii wzrostowej, czy też napotkała na turbulencje.</p>
<p>Aby odpowiedzieć na to pytanie, stworzyliśmy wizualizację przedstawiającą liczbę klientów obsużonych w każdym miesiącu. Zamiast polegać na subiektywnej ocenie, nałożyliśmy na dane linię trendu opartą na regresji liniowej, która w obiektywny sposób wskazuje kierunek, w którym zmierzamy.</p>
<div id="b525a567" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>query_clients_per_month <span class="op">=</span> text(<span class="st">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">    DATE_FORMAT(transaction_date, '%Y-%m') AS miesiac,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(DISTINCT client_id) AS liczba_klientow</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE transaction_date &lt; '2125-06-13'</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY miesiac</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY miesiac;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="07a9316b" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_clients <span class="op">=</span> pd.read_sql_query(query_clients_per_month, engine)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_clients[<span class="st">'srednia_kroczaca'</span>] <span class="op">=</span> df_clients[<span class="st">'liczba_klientow'</span>].rolling(window<span class="op">=</span><span class="dv">3</span>, center<span class="op">=</span><span class="va">True</span>, min_periods<span class="op">=</span><span class="dv">1</span>).mean()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="eeadbeb2" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(df_clients)) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_clients[<span class="st">'liczba_klientow'</span>] </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>slope, intercept, r_value, p_value, std_err <span class="op">=</span> stats.linregress(x, y)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>stagnation_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> slope <span class="op">&gt;</span> stagnation_threshold:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="ss">f"Firma wykazuje wyraźny trend WZROSTOWY."</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="ss">f"Średnio, z każdym miesiącem liczba klientów rośnie o </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ss">."</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'color: #198754;'</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> slope <span class="op">&lt;</span> <span class="op">-</span>stagnation_threshold:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="ss">f"Firma wykazuje wyraźny trend SPADKOWY."</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="ss">f"Średnio, z każdym miesiącem liczba klientów maleje o </span><span class="sc">{</span><span class="op">-</span>slope<span class="sc">:.2f}</span><span class="ss">."</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'color: #dc3545;'</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="st">"Firma wykazuje STAGNACJĘ."</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="ss">f"Brak wyraźnego trendu wzrostowego lub spadkowego (nachylenie linii trendu wynosi </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ss">)."</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'color: #dc3545;'</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Poniższy wykres prezentuje miesięczne dane wraz z wygładzoną linią trendu (średnia krocząca), która pomaga zwizualizować ogólną tendencję.</p>
<div id="27539004" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div>                            <div id="738dcbca-aca9-4c33-a021-6f3cbacb997f" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("738dcbca-aca9-4c33-a021-6f3cbacb997f")) {                    Plotly.newPlot(                        "738dcbca-aca9-4c33-a021-6f3cbacb997f",                        [{"marker":{"color":"skyblue"},"name":"Liczba klient\u00f3w w miesi\u0105cu","opacity":0.7,"x":["2120-06","2120-07","2120-08","2120-09","2120-10","2120-11","2120-12","2121-01","2121-02","2121-03","2121-04","2121-05","2121-06","2121-07","2121-08","2121-09","2121-10","2121-11","2121-12","2122-01","2122-02","2122-03","2122-04","2122-05","2122-06","2122-07","2122-08","2122-09","2122-10","2122-11","2122-12","2123-01","2123-02","2123-03","2123-04","2123-05","2123-06","2123-07","2123-08","2123-09","2123-10","2123-11","2123-12","2124-01","2124-02","2124-03","2124-04","2124-05","2124-06","2124-07","2124-08","2124-09","2124-10","2124-11","2124-12","2125-01","2125-02","2125-03","2125-04","2125-05","2125-06"],"y":[174,140,47,34,55,66,90,76,68,81,82,61,56,50,59,75,62,69,86,96,98,97,84,92,59,83,75,77,88,76,48,49,53,64,62,91,102,97,92,95,81,50,52,55,55,50,54,79,70,56,67,86,60,47,67,63,61,42,40,54,3],"type":"bar"},{"line":{"color":"crimson","width":3},"mode":"lines","name":"Trend (\u015brednia krocz\u0105ca)","x":["2120-06","2120-07","2120-08","2120-09","2120-10","2120-11","2120-12","2121-01","2121-02","2121-03","2121-04","2121-05","2121-06","2121-07","2121-08","2121-09","2121-10","2121-11","2121-12","2122-01","2122-02","2122-03","2122-04","2122-05","2122-06","2122-07","2122-08","2122-09","2122-10","2122-11","2122-12","2123-01","2123-02","2123-03","2123-04","2123-05","2123-06","2123-07","2123-08","2123-09","2123-10","2123-11","2123-12","2124-01","2124-02","2124-03","2124-04","2124-05","2124-06","2124-07","2124-08","2124-09","2124-10","2124-11","2124-12","2125-01","2125-02","2125-03","2125-04","2125-05","2125-06"],"y":[157.0,120.33333333333333,73.66666666666667,45.333333333333336,51.666666666666664,70.33333333333333,77.33333333333333,78.0,75.0,77.0,74.66666666666667,66.33333333333333,55.666666666666664,55.0,61.333333333333336,65.33333333333333,68.66666666666667,72.33333333333333,83.66666666666667,93.33333333333333,97.0,93.0,91.0,78.33333333333333,78.0,72.33333333333333,78.33333333333333,80.0,80.33333333333333,70.66666666666667,57.666666666666664,50.0,55.333333333333336,59.666666666666664,72.33333333333333,85.0,96.66666666666667,97.0,94.66666666666667,89.33333333333333,75.33333333333333,61.0,52.333333333333336,54.0,53.333333333333336,53.0,61.0,67.66666666666667,68.33333333333333,64.33333333333333,69.66666666666667,71.0,64.33333333333333,58.0,59.0,63.666666666666664,55.333333333333336,47.666666666666664,45.333333333333336,32.333333333333336,28.5],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"title":{"text":"Miesi\u0105c"},"tickangle":-45,"type":"category"},"title":{"text":"Miesi\u0119czna liczba obs\u0142u\u017conych klient\u00f3w i linia trendu"},"yaxis":{"title":{"text":"Liczba Klient\u00f3w"}},"legend":{"title":{"text":"Legenda"}},"bargap":0.2},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('738dcbca-aca9-4c33-a021-6f3cbacb997f');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="21d20b31" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>analiza_markdown <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ss">### Ocena Linii Trendu</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Analiza statystyczna oparta na regresji liniowej pozwala nam obiektywnie ocenić kierunek rozwoju firmy. Współczynnik nachylenia linii trendu to matematyczna reprezentacja naszego miesięcznego wzrostu lub spadku.&lt;/p&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p style='</span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">'&gt;&lt;b&gt;Wniosek: </span><span class="sc">{</span>wniosek<span class="sc">}</span><span class="ss">&lt;/b&gt;&lt;/p&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Wyjaśnienie: </span><span class="sc">{</span>szczegoly<span class="sc">}</span><span class="ss">&lt;/p&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>display(Markdown(analiza_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="ocena-linii-trendu" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="ocena-linii-trendu">Ocena Linii Trendu</h3>
<p>
Analiza statystyczna oparta na regresji liniowej pozwala nam obiektywnie ocenić kierunek rozwoju firmy. Współczynnik nachylenia linii trendu to matematyczna reprezentacja naszego miesięcznego wzrostu lub spadku.
</p>
<p style="color: #dc3545;">
<b>Wniosek: Firma wykazuje wyraźny trend SPADKOWY.</b>
</p>
<p>
Wyjaśnienie: Średnio, z każdym miesiącem liczba klientów maleje o 0.53.
</p>
</section>
</div>
</section>
<section id="analiza-ryzyka-operacyjnego" class="level2">
<h2 class="anchored" data-anchor-id="analiza-ryzyka-operacyjnego">Analiza ryzyka operacyjnego</h2>
<p>Zarządzanie ryzykiem w turystyce kosmicznej to nie tylko nasz obowiązek, ale fundament, na którym opiera się zaufanie naszych klientów i partnerów. W tej części raportu dokonujemy dogłębnej analizy dwóch głównych źródeł ryzyka: niebezpieczeństw związanych z celem podróży oraz potencjalnej awaryjności naszych statków kosmicznych. Celem jest identyfikacja “gorących punktów”, która pozwoli na wdrożenie działań prewencyjnych i podniesienie standardów bezpieczeństwa.</p>
<section id="ryzyko-związane-z-destynacja" class="level3">
<h3 class="anchored" data-anchor-id="ryzyko-związane-z-destynacja">Ryzyko związane z destynacja</h3>
<p>Każda destynacja w Układzie Słonecznym posiada unikalną charakterystykę i wiąże się z różnym poziomem wyzwań. Poniższy wykres przedstawia liczbę zarejestrowanych incydentów w podziale na lokalizacje oraz stopień ich powagi (niski, średni, wysoki).</p>
<div id="f833efda" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>query_incidents_graph <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">    d.name AS kierunek,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">    i.severity,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(i.incident_id) AS liczba_incydentow</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">    incidents i</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">    trips t ON i.trip_id = t.trip_id</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">    destinations d ON t.destination_id = d.destination_id</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">    i.severity IN ('high', 'medium', 'low')</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="st">    d.name, i.severity</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9063b488" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_incidents_long <span class="op">=</span> pd.read_sql(query_incidents_graph, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="130d5fde" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_total_incidents <span class="op">=</span> df_incidents_long.groupby(<span class="st">'kierunek'</span>)[<span class="st">'liczba_incydentow'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_incidents_long[<span class="st">'kierunek_sorted'</span>] <span class="op">=</span> pd.Categorical(df_incidents_long[<span class="st">'kierunek'</span>], categories<span class="op">=</span>df_total_incidents.index, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    df_incidents_long.sort_values(<span class="st">'kierunek_sorted'</span>), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'kierunek_sorted'</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'liczba_incydentow'</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'severity'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Liczba incydentów ze względu na destynację'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'kierunek_sorted'</span>: <span class="st">'Destynacja'</span>, <span class="st">'liczba_incydentow'</span>: <span class="st">'Łączna liczba incydentów'</span>, <span class="st">'severity'</span>: <span class="st">'Poziom zagrożenia'</span>},</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    color_discrete_map<span class="op">=</span>{<span class="st">'low'</span>: <span class="st">'#5cb85c'</span>, <span class="st">'medium'</span>: <span class="st">'#f0ad4e'</span>, <span class="st">'high'</span>: <span class="st">'#d9534f'</span>},</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    category_orders<span class="op">=</span>{<span class="st">'severity'</span>: [<span class="st">'low'</span>, <span class="st">'medium'</span>, <span class="st">'high'</span>]}</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="3e33ee5a-f461-4b59-8c48-1c5e99fbc9ca" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("3e33ee5a-f461-4b59-8c48-1c5e99fbc9ca")) {                    Plotly.newPlot(                        "3e33ee5a-f461-4b59-8c48-1c5e99fbc9ca",                        [{"alignmentgroup":"True","hovertemplate":"Poziom zagro\u017cenia=low\u003cbr\u003eDestynacja=%{x}\u003cbr\u003e\u0141\u0105czna liczba incydent\u00f3w=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"low","marker":{"color":"#5cb85c","pattern":{"shape":""}},"name":"low","offsetgroup":"low","orientation":"v","showlegend":true,"textposition":"auto","x":["Mars","Jowisz","Wenus","Merkury","Saturn"],"xaxis":"x","y":[7,3,4,2,3],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"Poziom zagro\u017cenia=medium\u003cbr\u003eDestynacja=%{x}\u003cbr\u003e\u0141\u0105czna liczba incydent\u00f3w=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"medium","marker":{"color":"#f0ad4e","pattern":{"shape":""}},"name":"medium","offsetgroup":"medium","orientation":"v","showlegend":true,"textposition":"auto","x":["Mars","Jowisz","Wenus","Merkury","Saturn"],"xaxis":"x","y":[16,9,11,8,7],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"Poziom zagro\u017cenia=high\u003cbr\u003eDestynacja=%{x}\u003cbr\u003e\u0141\u0105czna liczba incydent\u00f3w=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"high","marker":{"color":"#d9534f","pattern":{"shape":""}},"name":"high","offsetgroup":"high","orientation":"v","showlegend":true,"textposition":"auto","x":["Mars","Jowisz","Wenus","Merkury","Saturn"],"xaxis":"x","y":[7,7,3,2,1],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Destynacja"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"\u0141\u0105czna liczba incydent\u00f3w"}},"legend":{"title":{"text":"Poziom zagro\u017cenia"},"tracegroupgap":0},"title":{"text":"Liczba incydent\u00f3w ze wzgl\u0119du na destynacj\u0119"},"barmode":"relative"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('3e33ee5a-f461-4b59-8c48-1c5e99fbc9ca');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Sama liczba incydentów może być jednak myląca – popularna destynacja naturalnie odnotuje więcej zdarzeń. Aby uzyskać bardziej obiektywny obraz, stworzyliśmy ważony wskaźnik ryzyka. Przypisuje on punkty za każdy incydent w zależności od jego wagi (10 pkt za “High”, 3 za “Medium”, 1 za “Low”), a następnie dzieli sumę punktów przez liczbę wypraw do danej lokalizacji. Wynik pokazuje średnie “obciążenie ryzykiem” na jedną wyprawę.</p>
<div id="22da54af" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>query_weighted_risk <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">WITH trips_per_destination AS (</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT destination_id, COUNT(trip_id) AS total_trips</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM trips</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY destination_id</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">),</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">weighted_incidents AS (</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">        t.destination_id,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">        SUM(</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="st">            CASE </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="st">                WHEN i.severity = 'High' THEN 10</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="st">                WHEN i.severity = 'Medium' THEN 3</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="st">                WHEN i.severity = 'Low' THEN 1</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="st">                ELSE 0 </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="st">            END</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="st">        ) AS risk_score</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM incidents i</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="st">    JOIN trips t ON i.trip_id = t.trip_id</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY t.destination_id</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="st">    d.name AS Kierunek,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(tpd.total_trips, 0) AS Liczba_wypraw,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(wi.risk_score, 0) AS Suma_punktow_ryzyka,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(wi.risk_score / tpd.total_trips, 0) AS Wazony_wspolczynnik_ryzyka</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="st">FROM </span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="st">    destinations d</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN </span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="st">    trips_per_destination tpd ON d.destination_id = tpd.destination_id</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="st">    weighted_incidents wi ON d.destination_id = wi.destination_id</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="st">    tpd.total_trips &gt; 0</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY </span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="st">    Wazony_wspolczynnik_ryzyka DESC;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="55d8c6da" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_risk <span class="op">=</span> pd.read_sql(query_weighted_risk, engine)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>display(df_risk.style.<span class="bu">format</span>(<span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>, subset<span class="op">=</span>[<span class="st">'Wazony_wspolczynnik_ryzyka'</span>])<span class="op">\</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                 .<span class="bu">format</span>(<span class="st">'</span><span class="sc">{:,.0f}</span><span class="st">'</span>, subset<span class="op">=</span>[<span class="st">'Liczba_wypraw'</span>, <span class="st">'Suma_punktow_ryzyka'</span>])<span class="op">\</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                 .background_gradient(cmap<span class="op">=</span><span class="st">'Reds'</span>, subset<span class="op">=</span>[<span class="st">'Wazony_wspolczynnik_ryzyka'</span>])<span class="op">\</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                 .set_caption(<span class="st">"Ranking Ryzyka Destynacji (Wskaźnik ważony)"</span>))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_b847a_row0_col3 {
  background-color: #67000d;
  color: #f1f1f1;
}
#T_b847a_row1_col3 {
  background-color: #bd151a;
  color: #f1f1f1;
}
#T_b847a_row2_col3 {
  background-color: #fb7858;
  color: #f1f1f1;
}
#T_b847a_row3_col3 {
  background-color: #fcb69b;
  color: #000000;
}
#T_b847a_row4_col3 {
  background-color: #fff5f0;
  color: #000000;
}
</style>

<div id="T_b847a" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_b847a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;2: Ranking Ryzyka Destynacji (Wskaźnik ważony)
</figcaption>
<div aria-describedby="T_b847a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_b847a" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_b847a_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Kierunek</th>
<th id="T_b847a_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Liczba_wypraw</th>
<th id="T_b847a_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Suma_punktow_ryzyka</th>
<th id="T_b847a_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Wazony_wspolczynnik_ryzyka</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_b847a_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_b847a_row0_col0" class="data row0 col0">Jowisz</td>
<td id="T_b847a_row0_col1" class="data row0 col1">17</td>
<td id="T_b847a_row0_col2" class="data row0 col2">100</td>
<td id="T_b847a_row0_col3" class="data row0 col3">5.88</td>
</tr>
<tr class="even">
<td id="T_b847a_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_b847a_row1_col0" class="data row1 col0">Mars</td>
<td id="T_b847a_row1_col1" class="data row1 col1">25</td>
<td id="T_b847a_row1_col2" class="data row1 col2">125</td>
<td id="T_b847a_row1_col3" class="data row1 col3">5.00</td>
</tr>
<tr class="odd">
<td id="T_b847a_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_b847a_row2_col0" class="data row2 col0">Wenus</td>
<td id="T_b847a_row2_col1" class="data row2 col1">19</td>
<td id="T_b847a_row2_col2" class="data row2 col2">67</td>
<td id="T_b847a_row2_col3" class="data row2 col3">3.53</td>
</tr>
<tr class="even">
<td id="T_b847a_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_b847a_row3_col0" class="data row3 col0">Merkury</td>
<td id="T_b847a_row3_col1" class="data row3 col1">17</td>
<td id="T_b847a_row3_col2" class="data row3 col2">46</td>
<td id="T_b847a_row3_col3" class="data row3 col3">2.71</td>
</tr>
<tr class="odd">
<td id="T_b847a_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_b847a_row4_col0" class="data row4 col0">Saturn</td>
<td id="T_b847a_row4_col1" class="data row4 col1">22</td>
<td id="T_b847a_row4_col2" class="data row4 col2">34</td>
<td id="T_b847a_row4_col3" class="data row4 col3">1.55</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<div id="63c7ffd6" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>most_risky <span class="op">=</span> df_risk.iloc[<span class="dv">0</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>least_risky <span class="op">=</span> df_risk.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ss">### Podsumowanie Ryzyka Destynacji</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Nasz ważony wskaźnik pozwala na obiektywną ocenę i priorytetyzację działań redukujących ryzyko.&lt;/p&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;ul&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li&gt;&lt;span style="font-size: 1.5em;"&gt;&lt;/span&gt; &lt;b style='color: #dc3545;'&gt;Najwyższe ryzyko:&lt;/b&gt; Destynacją o najwyższym wskaźniku ryzyka jest &lt;b&gt;</span><span class="sc">{</span>most_risky[<span class="st">'Kierunek'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt; z wynikiem &lt;b&gt;</span><span class="sc">{</span>most_risky[<span class="st">'Wazony_wspolczynnik_ryzyka'</span>]<span class="sc">:.2f}</span><span class="ss"> pkt&lt;/b&gt; na wyprawę. Sugeruje to konieczność przeglądu procedur bezpieczeństwa dla tej trasy.&lt;/li&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li&gt;&lt;span style="font-size: 1.5em;"&gt;&lt;/span&gt; &lt;b style='color: #198754;'&gt;Najniższe ryzyko:&lt;/b&gt; Najbezpieczniejszą z naszych popularnych destynacji okazał/a się &lt;b&gt;</span><span class="sc">{</span>least_risky[<span class="st">'Kierunek'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt; (</span><span class="sc">{</span>least_risky[<span class="st">'Wazony_wspolczynnik_ryzyka'</span>]<span class="sc">:.2f}</span><span class="ss"> pkt/wyprawę). Praktyki stosowane na tej trasie mogą stanowić wzór dla innych.&lt;/li&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/ul&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>display(Markdown(wniosek_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="podsumowanie-ryzyka-destynacji" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="podsumowanie-ryzyka-destynacji">Podsumowanie Ryzyka Destynacji</h3>
<p>
Nasz ważony wskaźnik pozwala na obiektywną ocenę i priorytetyzację działań redukujących ryzyko.
</p>
<ul>
<li>
<span style="font-size: 1.5em;"></span> <b style="color: #dc3545;">Najwyższe ryzyko:</b> Destynacją o najwyższym wskaźniku ryzyka jest <b>Jowisz</b> z wynikiem <b>5.88 pkt</b> na wyprawę. Sugeruje to konieczność przeglądu procedur bezpieczeństwa dla tej trasy.
</li>
<li>
<span style="font-size: 1.5em;"></span> <b style="color: #198754;">Najniższe ryzyko:</b> Najbezpieczniejszą z naszych popularnych destynacji okazał/a się <b>Saturn</b> (1.55 pkt/wyprawę). Praktyki stosowane na tej trasie mogą stanowić wzór dla innych.
</li>
</ul>
</section>
</div>
</section>
<section id="ryzyko-związane-ze-sprzętem" class="level3">
<h3 class="anchored" data-anchor-id="ryzyko-związane-ze-sprzętem">Ryzyko związane ze sprzętem</h3>
<p>Nawet najbezpieczniejsza trasa staje się ryzykowna, jeśli statek kosmiczny jest zawodny. W tej części analizujemy dane dotyczące awarii sprzętu (category = ‘equipment’) w naszej flocie, aby zidentyfikować jednostki wymagające szczególnej uwagi serwisowej. Poniższy wykres szereguje statki według wskaźnika “usterki na wyprawę”.</p>
<div id="91fa505a" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>query_failure_rate <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">WITH trips_per_spacecraft AS (</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">        spacecraft_id, </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(trip_id) AS total_trips</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM trips</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY spacecraft_id</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">),</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="st">equipment_failures AS (</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="st">        t.spacecraft_id, </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(i.incident_id) AS total_failures</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM incidents i</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="st">    JOIN trips t ON i.trip_id = t.trip_id</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE i.category = 'equipment'</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY t.spacecraft_id</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="st">    s.name AS nazwa_statku,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(tps.total_trips, 0) AS liczba_wypraw,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(ef.total_failures, 0) AS liczba_usterek,</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="st">    CASE</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN tps.total_trips &gt; 0 THEN COALESCE(ef.total_failures, 0) / CAST(tps.total_trips AS FLOAT)</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="st">        ELSE 0</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="st">    END AS usterki_na_wyprawe</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="st">    spacecraft s</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="st">    trips_per_spacecraft tps ON s.spacecraft_id = tps.spacecraft_id</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="st">    equipment_failures ef ON s.spacecraft_id = ef.spacecraft_id</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="st">    usterki_na_wyprawe DESC;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ffa47e27" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_failure_rate <span class="op">=</span> pd.read_sql(query_failure_rate, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d7c818fd" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_plot <span class="op">=</span> df_failure_rate.sort_values(<span class="st">'usterki_na_wyprawe'</span>, ascending<span class="op">=</span><span class="va">True</span>).copy()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">'Status'</span>] <span class="op">=</span> np.where(df_plot[<span class="st">'usterki_na_wyprawe'</span>] <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">'Wystąpiły usterki'</span>, <span class="st">'Brak usterek'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    df_plot,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'nazwa_statku'</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'usterki_na_wyprawe'</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Usterki sprzętowe naszej floty'</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'nazwa_statku'</span>: <span class="st">'Statek kosmiczny'</span>, <span class="st">'usterki_na_wyprawe'</span>: <span class="st">'Średnia liczba usterek na wyprawę'</span>},</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'usterki_na_wyprawe'</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span><span class="st">'Reds'</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'usterki_na_wyprawe'</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>fig.update_traces(</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{x:.3f}</span><span class="st">'</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'outside'</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>max_value <span class="op">=</span> df_plot[<span class="st">'usterki_na_wyprawe'</span>].<span class="bu">max</span>()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, max_value <span class="op">*</span> <span class="fl">1.15</span>])</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    xaxis_gridcolor<span class="op">=</span><span class="st">'#ecf0f1'</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    coloraxis_showscale<span class="op">=</span><span class="va">False</span> </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="2062eef5-90d9-4def-80da-77036e70a546" class="plotly-graph-div" style="height:600px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("2062eef5-90d9-4def-80da-77036e70a546")) {                    Plotly.newPlot(                        "2062eef5-90d9-4def-80da-77036e70a546",                        [{"alignmentgroup":"True","hovertemplate":"\u015arednia liczba usterek na wypraw\u0119=%{marker.color}\u003cbr\u003eStatek kosmiczny=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.2,0.25,0.25,0.25,0.25,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.5,0.5,0.5,0.5,0.5,0.5,0.5714285714285714],"coloraxis":"coloraxis","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"h","showlegend":false,"text":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.2,0.25,0.25,0.25,0.25,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.5,0.5,0.5,0.5,0.5,0.5,0.5714285714285714],"textposition":"outside","x":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.2,0.25,0.25,0.25,0.25,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.5,0.5,0.5,0.5,0.5,0.5,0.5714285714285714],"xaxis":"x","y":["Vortex-One","Hyperion-X","Vortex-NX","Titan-7","Eclipse-Prime","Pulsar-7","Nova-Infinity","Zenith-Core","Celestia-Core","Zenith-One","Titan-Edge","Eclipse-X","Luna-7","Vortex-Infinity","Astra-Ultra","Nova-One","Luna-One","Vortex-Ultra","Zenith-7","Pulsar-Edge","Luna-Edge","Zenith-Ultra","Luna-VX","Hyperion-Edge","Nova-Prime","Astra-Edge","Hyperion-Infinity","Pulsar-NX","Luna-Core","Eclipse-Infinity"],"yaxis":"y","type":"bar","texttemplate":"%{x:.3f}"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"\u015arednia liczba usterek na wypraw\u0119"},"range":[0,0.657142857142857],"gridcolor":"#ecf0f1"},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Statek kosmiczny"}},"coloraxis":{"colorbar":{"title":{"text":"\u015arednia liczba usterek na wypraw\u0119"}},"colorscale":[[0.0,"rgb(255,245,240)"],[0.125,"rgb(254,224,210)"],[0.25,"rgb(252,187,161)"],[0.375,"rgb(252,146,114)"],[0.5,"rgb(251,106,74)"],[0.625,"rgb(239,59,44)"],[0.75,"rgb(203,24,29)"],[0.875,"rgb(165,15,21)"],[1.0,"rgb(103,0,13)"]],"showscale":false},"legend":{"tracegroupgap":0},"title":{"text":"Usterki sprz\u0119towe naszej floty"},"barmode":"relative","height":600,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('2062eef5-90d9-4def-80da-77036e70a546');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="50c39321" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>most_failure_prone <span class="op">=</span> df_failure_rate.iloc[<span class="dv">0</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>zero_failure_ships <span class="op">=</span> df_failure_rate[df_failure_rate[<span class="st">'usterki_na_wyprawe'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>count_zero_failure <span class="op">=</span> <span class="bu">len</span>(zero_failure_ships)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="st">### Ocena Niezawodności Floty</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;p&gt;Analiza wskaźnika usterek pozwala na precyzyjne planowanie przeglądów serwisowych i alokację budżetu na utrzymanie floty.&lt;/p&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;ul&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>liczba_usterek_prone <span class="op">=</span> <span class="bu">int</span>(most_failure_prone[<span class="st">'liczba_usterek'</span>])</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>liczba_wypraw_prone <span class="op">=</span> <span class="bu">int</span>(most_failure_prone[<span class="st">'liczba_wypraw'</span>])</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">+=</span> <span class="ss">f"""</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b style='color: #dc3545;'&gt;Wymaga uwagi:&lt;/b&gt; Najbardziej podatny na usterki sprzętowe jest statek &lt;b&gt;</span><span class="sc">{</span>most_failure_prone[<span class="st">'nazwa_statku'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt;. </span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="ss">Odnotowuje on średnio &lt;b&gt;</span><span class="sc">{</span>most_failure_prone[<span class="st">'usterki_na_wyprawe'</span>]<span class="sc">:.3f}</span><span class="ss"> usterki&lt;/b&gt; na każdą odbytą wyprawę. &lt;br&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;small style="color: #6c757d;"&gt;&lt;i&gt;(Na podstawie </span><span class="sc">{</span>liczba_usterek_prone<span class="sc">}</span><span class="ss"> usterek w ciągu </span><span class="sc">{</span>liczba_wypraw_prone<span class="sc">}</span><span class="ss"> wypraw)&lt;/i&gt;&lt;/small&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/li&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>workhorse_champion <span class="op">=</span> zero_failure_ships.sort_values(<span class="st">'liczba_wypraw'</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[<span class="dv">0</span>]</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>liczba_wypraw_champion <span class="op">=</span> <span class="bu">int</span>(workhorse_champion[<span class="st">'liczba_wypraw'</span>])</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">+=</span> <span class="ss">f"""</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b style='color: #198754;'&gt;Wzór niezawodności:&lt;/b&gt; Aż &lt;b&gt;</span><span class="sc">{</span>count_zero_failure<span class="sc">}</span><span class="ss"> jednostek&lt;/b&gt; w naszej flocie zakończyło wszystkie misje w analizowanym okresie bez żadnej usterki sprzętowej.</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ss">Na szczególne wyróżnienie zasługuje &lt;b&gt;</span><span class="sc">{</span>workhorse_champion[<span class="st">'nazwa_statku'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt;, który jest najczęściej eksploatowaną jednostką w tej grupie.&lt;br&gt;</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;small style="color: #6c757d;"&gt;&lt;i&gt;(Wykonał bezawaryjnie aż </span><span class="sc">{</span>liczba_wypraw_champion<span class="sc">}</span><span class="ss"> misji)&lt;/i&gt;&lt;/small&gt;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/li&gt;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">+=</span> <span class="st">"&lt;/ul&gt;"</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>display(Markdown(wniosek_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="ocena-niezawodności-floty" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="ocena-niezawodności-floty">Ocena Niezawodności Floty</h3>
<p>
Analiza wskaźnika usterek pozwala na precyzyjne planowanie przeglądów serwisowych i alokację budżetu na utrzymanie floty.
</p>
<ul>
<li>
<b style="color: #dc3545;">Wymaga uwagi:</b> Najbardziej podatny na usterki sprzętowe jest statek <b>Eclipse-Infinity</b>. Odnotowuje on średnio <b>0.571 usterki</b> na każdą odbytą wyprawę. <br> <small style="color: #6c757d;"><i>(Na podstawie 4 usterek w ciągu 7 wypraw)</i></small>
</li>
<li>
<b style="color: #198754;">Wzór niezawodności:</b> Aż <b>14 jednostek</b> w naszej flocie zakończyło wszystkie misje w analizowanym okresie bez żadnej usterki sprzętowej. Na szczególne wyróżnienie zasługuje <b>Zenith-One</b>, który jest najczęściej eksploatowaną jednostką w tej grupie.<br> <small style="color: #6c757d;"><i>(Wykonał bezawaryjnie aż 5 misji)</i></small>
</li>
</ul>
</section>
</div>
</section>
</section>
<section id="wpływ-incydentów-na-satysfakcję-klienta" class="level2">
<h2 class="anchored" data-anchor-id="wpływ-incydentów-na-satysfakcję-klienta">Wpływ incydentów na satysfakcję klienta</h2>
<p>W tej części analizy łączymy “twarde” dane operacyjne z “miękkimi” danymi dotyczącymi odczuć naszych pasażerów. Stawiamy fundamentalne pytanie: czy liczba incydentów zarejestrowanych podczas wyprawy ma statystycznie istotny wpływ na jej końcową ocenę?</p>
<p>Intuicja podpowiada, że każda, nawet drobna usterka czy incydent, może negatywnie wpłynąć na postrzeganie całej, skądinąd udanej, wyprawy. Potwierdzenie lub obalenie tej tezy ma kluczowe znaczenie dla zrozumienia, jak krytyczne jest zapewnienie bezproblemowego przebiegu misji nie tylko dla bezpieczeństwa, ale i dla reputacji oraz siły naszej marki.</p>
<p>Poniższy wykres punktowy przedstawia zależność między średnią oceną danej wyprawy a liczbą odnotowanych w jej trakcie incydentów. Czerwona linia trendu wizualizuje ogólną tendencję tej zależności.</p>
<div id="efed6280" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>query_correlation <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">WITH avg_ratings AS (</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT trip_id, AVG(rating) AS avg_rating</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM feedback</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY trip_id</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">),</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">incident_counts AS (</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT trip_id, COUNT(incident_id) AS incident_count</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM incidents</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY trip_id</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">    t.trip_id,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="st">    ar.avg_rating AS srednia_ocena,</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(ic.incident_count, 0) AS liczba_incydentow</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">FROM </span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">    trips t</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN </span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="st">    avg_ratings ar ON t.trip_id = ar.trip_id</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN </span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="st">    incident_counts ic ON t.trip_id = ic.trip_id;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="3e1f30e5" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_correlation <span class="op">=</span> pd.read_sql(query_correlation, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d5a14f22" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    df_correlation,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'liczba_incydentow'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Zależność Oceny Wyprawy od Liczby Incydentów'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'liczba_incydentow'</span>: <span class="st">'Liczba incydentów podczas wyprawy'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'srednia_ocena'</span>: <span class="st">'Średnia ocena wyprawy (1-5)'</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    trendline<span class="op">=</span><span class="st">'ols'</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    trendline_color_override<span class="op">=</span><span class="st">'#e74c3c'</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    xaxis_gridcolor<span class="op">=</span><span class="st">'#ecf0f1'</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    yaxis_gridcolor<span class="op">=</span><span class="st">'#ecf0f1'</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>max_incidents <span class="op">=</span> <span class="bu">int</span>(df_correlation[<span class="st">'liczba_incydentow'</span>].<span class="bu">max</span>())</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    dtick<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="fl">0.5</span>, max_incidents <span class="op">+</span> <span class="fl">0.5</span>]</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="c0e029b6-5f6a-4203-8b06-b9a192baacbc" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("c0e029b6-5f6a-4203-8b06-b9a192baacbc")) {                    Plotly.newPlot(                        "c0e029b6-5f6a-4203-8b06-b9a192baacbc",                        [{"hovertemplate":"Liczba incydent\u00f3w podczas wyprawy=%{x}\u003cbr\u003e\u015arednia ocena wyprawy (1-5)=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":"#636efa","symbol":"circle"},"mode":"markers","name":"","orientation":"v","showlegend":false,"x":[0,2,2,1,0,1,1,1,2,0,2,1,1,2,2,1,0,1,1,0,2,2,2,0,1,2,2,2,2,1,1,2,0,2,1,1,1,0,2,0,1,2,1,2,1,2,0,2,2,0,2,1,0,1,2,0,1,1,0,1,0,1,0,1,2,0,1,0,0,0,1,0,0,0,1,1,0,2,2,2,2,2,2,0,2,0,2,1,0,2,0,1,2,2,0],"xaxis":"x","y":[4.7419,3.9444,4.2059,4.4412,4.6757,3.9697,4.3077,4.125,4.4,4.5143,4.4286,4.28,3.9375,3.6429,4.0,4.1795,4.561,4.0526,3.6774,4.4419,3.9189,3.7407,4.0,4.6111,4.2571,4.3429,3.88,3.9459,4.4375,3.5938,4.3333,3.9535,4.6129,4.2692,4.325,4.3889,3.6176,4.6154,3.9697,4.5641,4.3333,4.2703,4.0,4.2,4.3214,4.303,4.5714,3.9706,4.2813,4.6,3.4828,4.4118,4.4615,3.9429,4.2941,4.6923,4.1842,3.6667,4.7027,3.4878,4.6176,4.3333,4.6,3.6765,4.4054,4.5625,4.25,4.3235,4.8214,4.6,4.0,4.5,4.6471,4.5806,4.4146,3.5556,4.5952,4.1667,4.3056,4.2353,3.5313,4.1852,4.2821,4.4545,4.6,4.6341,4.3421,4.6667,4.5556,4.2564,4.5814,4.4828,4.0244,3.6786,4.5455],"yaxis":"y","type":"scatter"},{"hovertemplate":"\u003cb\u003eOLS trendline\u003c\u002fb\u003e\u003cbr\u003esrednia_ocena = -0.229667 * liczba_incydentow + 4.4978\u003cbr\u003eR\u003csup\u003e2\u003c\u002fsup\u003e=0.321314\u003cbr\u003e\u003cbr\u003eLiczba incydent\u00f3w podczas wyprawy=%{x}\u003cbr\u003e\u015arednia ocena wyprawy (1-5)=%{y} \u003cb\u003e(trend)\u003c\u002fb\u003e\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","line":{"color":"#e74c3c"},"marker":{"color":"#636efa","symbol":"circle"},"mode":"lines","name":"","showlegend":false,"x":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"xaxis":"x","y":[4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.497797468563866,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.268130542686961,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057,4.038463616810057],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Liczba incydent\u00f3w podczas wyprawy"},"gridcolor":"#ecf0f1","dtick":1,"range":[-0.5,2.5]},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"\u015arednia ocena wyprawy (1-5)"},"gridcolor":"#ecf0f1"},"legend":{"tracegroupgap":0},"title":{"text":"Zale\u017cno\u015b\u0107 Oceny Wyprawy od Liczby Incydent\u00f3w"},"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('c0e029b6-5f6a-4203-8b06-b9a192baacbc');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="5ae999ae" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>correlation_coeff <span class="op">=</span> df_correlation[<span class="st">'srednia_ocena'</span>].corr(df_correlation[<span class="st">'liczba_incydentow'</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Logika wniosków</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> correlation_coeff <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.5</span>:</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="st">"Istnieje silna korelacja ujemna."</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="st">"Wzrost liczby incydentów jest silnie powiązany ze spadkiem średniej oceny wyprawy."</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> correlation_coeff <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.2</span>:</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="st">"Istnieje zauważalna korelacja ujemna."</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="st">"Wzrost liczby incydentów ma tendencję do obniżania średniej oceny wyprawy."</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    wniosek <span class="op">=</span> <span class="st">"Brak silnej korelacji."</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    szczegoly <span class="op">=</span> <span class="st">"Liczba incydentów nie wydaje się mieć decydującego wpływu na ocenę końcową. Klienci prawdopodobnie biorą pod uwagę inne czynniki, takie jak widoki, jakość obsługi czy profesjonalizm załogi w radzeniu sobie z incydentem."</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="08aecfc7" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>analiza_markdown <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ss">### Analiza korelacji</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Obliczony współczynnik korelacji Pearsona dla badanych zmiennych wynosi: &lt;b&gt;</span><span class="sc">{</span>correlation_coeff<span class="sc">:.3f}</span><span class="ss">&lt;/b&gt;.&lt;/p&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p style="font-size: 1.1em;"&gt;&lt;b&gt;Wniosek:&lt;/b&gt; </span><span class="sc">{</span>wniosek<span class="sc">}</span><span class="ss">&lt;/p&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Wyjaśnienie: </span><span class="sc">{</span>szczegoly<span class="sc">}</span><span class="ss">&lt;/p&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>display(Markdown(analiza_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="analiza-korelacji" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="analiza-korelacji">Analiza korelacji</h3>
<p>
Obliczony współczynnik korelacji Pearsona dla badanych zmiennych wynosi: <b>-0.567</b>.
</p>
<p style="font-size: 1.1em;">
<b>Wniosek:</b> Istnieje silna korelacja ujemna.
</p>
<p>
Wyjaśnienie: Wzrost liczby incydentów jest silnie powiązany ze spadkiem średniej oceny wyprawy.
</p>
</section>
</div>
</section>
<section id="głos-klienta---analiza-ocen-wypraw" class="level2">
<h2 class="anchored" data-anchor-id="głos-klienta---analiza-ocen-wypraw">Głos klienta - analiza ocen wypraw</h2>
<p>Po analizie wskaźników operacyjnych i finansowych, nadszedł czas, aby wsłuchać się w najważniejszy głos w naszym biznesie – głos klienta. Oceny wystawiane po każdej wyprawie są bezcennym źródłem informacji o naszych mocnych i słabych stronach. W tej sekcji zidentyfikujemy, które elementy naszej oferty są najbardziej doceniane, a które wymagają naszej uwagi.</p>
<p>Analiza opiera się na wszystkich zebranych ocenach, z wyłączeniem destynacji i typów wypraw z małą liczbą opinii (poniżej 3), aby zapewnić statystyczną istotność wyników.</p>
<section id="ranking-ocen-destynacji" class="level3">
<h3 class="anchored" data-anchor-id="ranking-ocen-destynacji">Ranking ocen destynacji</h3>
<p>Pierwszym krokiem jest zrozumienie, które lokalizacje w Układzie Słonecznym dostarczają naszym pasażerom najlepszych wrażeń. Poniższy wykres szereguje nasze destynacje od najniżej do najwyżej ocenianych.</p>
<div id="b7015913" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>query_dest_ratings <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">    d.name AS kierunek,</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">    AVG(f.rating) AS srednia_ocena,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(f.rating) AS liczba_ocen</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="st">    feedback f</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="st">    trips t ON f.trip_id = t.trip_id</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="st">    destinations d ON t.destination_id = d.destination_id</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE f.rating IS NOT NULL</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="st">    d.name</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="st">HAVING</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(f.rating) &gt; 2</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="st">    srednia_ocena DESC;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1b6c02f8" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_dest_ratings <span class="op">=</span> pd.read_sql(query_dest_ratings, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8634936f" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig_dest <span class="op">=</span> px.bar(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    df_dest_ratings,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'kierunek'</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Ranking średnich ocen dla poszczególnych destynacji'</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'srednia_ocena'</span>: <span class="st">'Średnia ocena (w skali 1-5)'</span>, <span class="st">'kierunek'</span>: <span class="st">'Destynacja'</span>},</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'kierunek'</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>px.colors.qualitative.Vivid,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>fig_dest.update_traces(texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text:.2f}</span><span class="st">'</span>, textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>fig_dest.update_layout(showlegend<span class="op">=</span><span class="va">False</span>,xaxis<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">5.2</span>]), plot_bgcolor<span class="op">=</span><span class="st">'white'</span>, yaxis<span class="op">=</span>{<span class="st">'categoryorder'</span>:<span class="st">'total ascending'</span>})</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>fig_dest.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="d4aa01ca-55a0-4687-b4e6-e4d78b7b2c06" class="plotly-graph-div" style="height:500px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("d4aa01ca-55a0-4687-b4e6-e4d78b7b2c06")) {                    Plotly.newPlot(                        "d4aa01ca-55a0-4687-b4e6-e4d78b7b2c06",                        [{"alignmentgroup":"True","hovertemplate":"Destynacja=%{y}\u003cbr\u003e\u015arednia ocena (w skali 1-5)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Saturn","marker":{"color":"rgb(229, 134, 6)","pattern":{"shape":""}},"name":"Saturn","offsetgroup":"Saturn","orientation":"h","showlegend":true,"text":[4.3385],"textposition":"outside","x":[4.3385],"xaxis":"x","y":["Saturn"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"},{"alignmentgroup":"True","hovertemplate":"Destynacja=%{y}\u003cbr\u003e\u015arednia ocena (w skali 1-5)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Merkury","marker":{"color":"rgb(93, 105, 177)","pattern":{"shape":""}},"name":"Merkury","offsetgroup":"Merkury","orientation":"h","showlegend":true,"text":[4.2794],"textposition":"outside","x":[4.2794],"xaxis":"x","y":["Merkury"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"},{"alignmentgroup":"True","hovertemplate":"Destynacja=%{y}\u003cbr\u003e\u015arednia ocena (w skali 1-5)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Wenus","marker":{"color":"rgb(82, 188, 163)","pattern":{"shape":""}},"name":"Wenus","offsetgroup":"Wenus","orientation":"h","showlegend":true,"text":[4.2705],"textposition":"outside","x":[4.2705],"xaxis":"x","y":["Wenus"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"},{"alignmentgroup":"True","hovertemplate":"Destynacja=%{y}\u003cbr\u003e\u015arednia ocena (w skali 1-5)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Mars","marker":{"color":"rgb(153, 201, 69)","pattern":{"shape":""}},"name":"Mars","offsetgroup":"Mars","orientation":"h","showlegend":true,"text":[4.2143],"textposition":"outside","x":[4.2143],"xaxis":"x","y":["Mars"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"},{"alignmentgroup":"True","hovertemplate":"Destynacja=%{y}\u003cbr\u003e\u015arednia ocena (w skali 1-5)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Jowisz","marker":{"color":"rgb(204, 97, 176)","pattern":{"shape":""}},"name":"Jowisz","offsetgroup":"Jowisz","orientation":"h","showlegend":true,"text":[4.2],"textposition":"outside","x":[4.2],"xaxis":"x","y":["Jowisz"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"\u015arednia ocena (w skali 1-5)"},"range":[0,5.2]},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Destynacja"},"categoryorder":"total ascending","categoryarray":["Jowisz","Mars","Wenus","Merkury","Saturn"]},"legend":{"title":{"text":"Destynacja"},"tracegroupgap":0},"title":{"text":"Ranking \u015brednich ocen dla poszczeg\u00f3lnych destynacji"},"barmode":"relative","height":500,"showlegend":false,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('d4aa01ca-55a0-4687-b4e6-e4d78b7b2c06');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="67865696" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>best_dest <span class="op">=</span> df_dest_ratings.iloc[<span class="dv">0</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>worst_dest <span class="op">=</span> df_dest_ratings.iloc[<span class="dv">1</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>wniosek_markdown <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ss">### Podsumowanie ocen destynacji</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Analiza ocen pozwala zidentyfikować nasze "perełki" oraz obszary wymagające poprawy doświadczeń klienta.&lt;/p&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;ul&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li&gt;&lt;b style='color: #198754;'&gt;Najwyżej oceniana:&lt;/b&gt; Destynacją, która dostarcza naszym klientom najwięcej satysfakcji, jest &lt;b&gt;</span><span class="sc">{</span>best_dest[<span class="st">'kierunek'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt; ze średnią oceną &lt;b&gt;</span><span class="sc">{</span>best_dest[<span class="st">'srednia_ocena'</span>]<span class="sc">:.2f}</span><span class="ss">&lt;/b&gt; (na podstawie </span><span class="sc">{</span><span class="bu">int</span>(best_dest[<span class="st">'liczba_ocen'</span>])<span class="sc">}</span><span class="ss"> opinii).&lt;/li&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li style="margin-top: 15px;"&gt;&lt;b style='color: #dc3545;'&gt;Wymaga uwagi:&lt;/b&gt; Najniższe oceny otrzymuje &lt;b&gt;</span><span class="sc">{</span>worst_dest[<span class="st">'kierunek'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt; (średnia &lt;b&gt;</span><span class="sc">{</span>worst_dest[<span class="st">'srednia_ocena'</span>]<span class="sc">:.2f}</span><span class="ss">&lt;/b&gt; z </span><span class="sc">{</span><span class="bu">int</span>(worst_dest[<span class="st">'liczba_ocen'</span>])<span class="sc">}</span><span class="ss"> opinii). Rekomendujemy analizę feedbacku z tej trasy w celu identyfikacji przyczyn niższej satysfakcji.&lt;/li&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/ul&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>display(Markdown(wniosek_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="podsumowanie-ocen-destynacji" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="podsumowanie-ocen-destynacji">Podsumowanie ocen destynacji</h3>
<p>
Analiza ocen pozwala zidentyfikować nasze “perełki” oraz obszary wymagające poprawy doświadczeń klienta.
</p>
<ul>
<li>
<b style="color: #198754;">Najwyżej oceniana:</b> Destynacją, która dostarcza naszym klientom najwięcej satysfakcji, jest <b>Saturn</b> ze średnią oceną <b>4.34</b> (na podstawie 703 opinii).
</li>
<li style="margin-top: 15px;">
<b style="color: #dc3545;">Wymaga uwagi:</b> Najniższe oceny otrzymuje <b>Merkury</b> (średnia <b>4.28</b> z 569 opinii). Rekomendujemy analizę feedbacku z tej trasy w celu identyfikacji przyczyn niższej satysfakcji.
</li>
</ul>
</section>
</div>
</section>
<section id="ranking-ocen-rodzajów-wypraw" class="level3">
<h3 class="anchored" data-anchor-id="ranking-ocen-rodzajów-wypraw">Ranking ocen rodzajów wypraw</h3>
<p>Następnie sprawdzamy, które typy misji – niezależnie od celu podróży – są najlepiej odbierane przez pasażerów. To pozwala nam ocenić, czy nasze “opakowanie” produktu (luksusowe, badawcze, ekstremalne itd.) trafia w gusta klientów.</p>
<div id="6b219944" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>query_type_ratings <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">    tt.name AS typ_wyprawy,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">    AVG(f.rating) AS srednia_ocena,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(f.rating) AS liczba_ocen</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="st">    feedback f</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="st">    trips t ON f.trip_id = t.trip_id</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="st">    trip_types tt ON t.trip_type_id = tt.trip_type_id</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE f.rating IS NOT NULL</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="st">    tt.name</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="st">HAVING</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(f.rating) &gt; 2</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="st">    srednia_ocena DESC;</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="322f29ed" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_type_ratings <span class="op">=</span> pd.read_sql(query_type_ratings, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="480e8d97" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig_type <span class="op">=</span> px.bar(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    df_type_ratings,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'typ_wyprawy'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Ranking średnich ocen dla rodzajów wypraw'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'srednia_ocena'</span>: <span class="st">'Średnia ocena (w skali 1-5)'</span>, <span class="st">'typ_wyprawy'</span>: <span class="st">'Rodzaj wyprawy'</span>},</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span><span class="st">'Viridis'</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'srednia_ocena'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>fig_type.update_traces(texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text:.2f}</span><span class="st">'</span>, textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>fig_type.update_layout(xaxis<span class="op">=</span><span class="bu">dict</span>(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">5.2</span>]), plot_bgcolor<span class="op">=</span><span class="st">'white'</span>, yaxis<span class="op">=</span>{<span class="st">'categoryorder'</span>:<span class="st">'total ascending'</span>})</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>fig_type.update_coloraxes(showscale<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>fig_type.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="47641093-cb91-4dd7-883e-7da5281eda23" class="plotly-graph-div" style="height:500px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("47641093-cb91-4dd7-883e-7da5281eda23")) {                    Plotly.newPlot(                        "47641093-cb91-4dd7-883e-7da5281eda23",                        [{"alignmentgroup":"True","hovertemplate":"\u015arednia ocena (w skali 1-5)=%{marker.color}\u003cbr\u003eRodzaj wyprawy=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":[4.3582,4.3113,4.2872,4.2687,4.2549,4.2459,4.1708,4.1518],"coloraxis":"coloraxis","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"h","showlegend":false,"text":[4.3582,4.3113,4.2872,4.2687,4.2549,4.2459,4.1708,4.1518],"textposition":"outside","x":[4.3582,4.3113,4.2872,4.2687,4.2549,4.2459,4.1708,4.1518],"xaxis":"x","y":["Manewry Orbitalne","Eksploracja Magnetosfery","Widokowe Obserwacje Nieba","Baza Kosmiczna - Pobyt","Przelot Przez Pole Promieniowania","Wycieczka Orbitalna","Przygoda Atmosferyczna","Wyprawa Powierzchniowa"],"yaxis":"y","type":"bar","texttemplate":"%{text:.2f}"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"\u015arednia ocena (w skali 1-5)"},"range":[0,5.2]},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Rodzaj wyprawy"},"categoryorder":"total ascending"},"coloraxis":{"colorbar":{"title":{"text":"\u015arednia ocena (w skali 1-5)"}},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"showscale":false},"legend":{"tracegroupgap":0},"title":{"text":"Ranking \u015brednich ocen dla rodzaj\u00f3w wypraw"},"barmode":"relative","height":500,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('47641093-cb91-4dd7-883e-7da5281eda23');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="02a2df22" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>best_type <span class="op">=</span> df_type_ratings.iloc[<span class="dv">0</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>worst_type <span class="op">=</span> df_type_ratings.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>wniosek_markdown_2 <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ss">### Podsumowanie ocen rodzajów wypraw</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;ul&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li&gt;&lt;b style='color: #198754;'&gt;Ulubiony typ wyprawy:&lt;/b&gt; Klienci najwyżej oceniają format &lt;b&gt;</span><span class="sc">{</span>best_type[<span class="st">'typ_wyprawy'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt;, przyznając mu średnią ocenę &lt;b&gt;</span><span class="sc">{</span>best_type[<span class="st">'srednia_ocena'</span>]<span class="sc">:.2f}</span><span class="ss">&lt;/b&gt; (na podstawie </span><span class="sc">{</span><span class="bu">int</span>(best_type[<span class="st">'liczba_ocen'</span>])<span class="sc">}</span><span class="ss"> opinii). Warto inwestować w promocję tego segmentu.&lt;/li&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;li style="margin-top: 15px;"&gt;&lt;b style='color: #dc3545;'&gt;Do przemyślenia:&lt;/b&gt; Największe wyzwanie stanowi format &lt;b&gt;</span><span class="sc">{</span>worst_type[<span class="st">'typ_wyprawy'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt; (średnia &lt;b&gt;</span><span class="sc">{</span>worst_type[<span class="st">'srednia_ocena'</span>]<span class="sc">:.2f}</span><span class="ss">&lt;/b&gt; z </span><span class="sc">{</span><span class="bu">int</span>(worst_type[<span class="st">'liczba_ocen'</span>])<span class="sc">}</span><span class="ss"> opinii). Należy zastanowić się, czy oczekiwania klientów wobec tego typu wypraw są w pełni zaspokajane.&lt;/li&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/ul&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>display(Markdown(wniosek_markdown_2))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="podsumowanie-ocen-rodzajów-wypraw" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="podsumowanie-ocen-rodzajów-wypraw">Podsumowanie ocen rodzajów wypraw</h3>
<ul>
<li>
<b style="color: #198754;">Ulubiony typ wyprawy:</b> Klienci najwyżej oceniają format <b>Manewry Orbitalne</b>, przyznając mu średnią ocenę <b>4.36</b> (na podstawie 282 opinii). Warto inwestować w promocję tego segmentu.
</li>
<li style="margin-top: 15px;">
<b style="color: #dc3545;">Do przemyślenia:</b> Największe wyzwanie stanowi format <b>Wyprawa Powierzchniowa</b> (średnia <b>4.15</b> z 303 opinii). Należy zastanowić się, czy oczekiwania klientów wobec tego typu wypraw są w pełni zaspokajane.
</li>
</ul>
</section>
</div>
</section>
</section>
<section id="profil-demograficzny-klientów---analiza-wieku" class="level2">
<h2 class="anchored" data-anchor-id="profil-demograficzny-klientów---analiza-wieku">Profil demograficzny klientów - analiza wieku</h2>
<p>Zrozumienie, “kim” jest nasz klient, jest równie ważne, jak wiedza, “dokąd” chce podróżować. Wiek jest jednym z fundamentalnych wymiarów demograficznych, który wpływa na preferencje, możliwości finansowe oraz styl komunikacji. Analiza struktury wiekowej naszej bazy klientów pozwala nam zweryfikować, czy nasza oferta trafia do zamierzonej grupy docelowej i gdzie leżą potencjalne, niewykorzystane jeszcze segmenty rynku.</p>
<p>Poniższa analiza opiera się na datach urodzenia wszystkich naszych zarejestrowanych klientów.</p>
<div id="161e7578" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>query_dob <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT date_of_birth</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM clients</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE date_of_birth IS NOT NULL;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e39aadea" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_dob <span class="op">=</span> pd.read_sql(query_dob, engine)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="3b972b42" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>today_real <span class="op">=</span> date.today()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_dob[<span class="st">'age'</span>] <span class="op">=</span> df_dob[<span class="st">'date_of_birth'</span>].<span class="bu">apply</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dob: (today_real <span class="op">-</span> dob).days <span class="op">/</span> <span class="fl">365.25</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>) <span class="op">+</span> <span class="dv">100</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>df_dob[<span class="st">'age'</span>] <span class="op">=</span> df_dob[<span class="st">'age'</span>].astype(<span class="bu">int</span>)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d75aeadf" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.histogram(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    df_dob,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'age'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    nbins<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Rozkład wieku klientów Space-U'</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'age'</span>: <span class="st">'Wiek klienta (w latach)'</span>, <span class="st">'count'</span>: <span class="st">'Liczba klientów'</span>},</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    marginal<span class="op">=</span><span class="st">'rug'</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    histnorm<span class="op">=</span><span class="st">'percent'</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Udział procentowy klientów'</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    bargap<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    yaxis_ticksuffix<span class="op">=</span><span class="st">'%'</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>fig.update_traces(</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    marker_color<span class="op">=</span><span class="st">'#3498db'</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    hovertemplate<span class="op">=</span><span class="st">'Wiek: %</span><span class="sc">{x}</span><span class="st">&lt;br&gt;Udział: %</span><span class="sc">{y:.2f}</span><span class="st">%'</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="40134195-0e4b-4800-8744-6e770fd66f91" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("40134195-0e4b-4800-8744-6e770fd66f91")) {                    Plotly.newPlot(                        "40134195-0e4b-4800-8744-6e770fd66f91",                        [{"alignmentgroup":"True","bingroup":"x","histnorm":"percent","hovertemplate":"Wiek: %{x}\u003cbr\u003eUdzia\u0142: %{y:.2f}%","legendgroup":"","marker":{"color":"#3498db","pattern":{"shape":""}},"name":"","nbinsx":25,"offsetgroup":"","orientation":"v","showlegend":false,"x":[34,31,42,60,55,40,39,68,18,32,60,48,43,51,56,60,44,52,28,18,39,64,48,27,66,44,68,28,60,18,18,64,44,47,20,24,23,39,42,18,40,36,32,26,48,32,28,52,50,35,22,28,42,68,58,42,28,42,46,46,42,31,43,28,46,47,48,38,28,40,56,18,21,18,38,31,18,36,48,18,46,55,35,54,52,52,30,36,21,46,56,26,72,48,56,67,34,18,42,18,72,40,39,32,18,40,60,55,18,40,68,52,24,64,28,36,31,36,40,52,39,30,44,18,19,58,35,50,55,40,48,43,46,52,59,68,72,32,38,47,38,34,59,66,43,30,50,36,40,48,35,36,38,22,36,52,50,58,72,60,28,32,52,64,32,44,23,46,43,28,62,56,32,56,44,31,27,36,48,42,48,40,18,26,28,38,48,22,63,50,31,64,50,27,18,30,51,68,24,52,21,36,36,27,48,28,40,75,40,18,52,74,51,47,40,18,36,22,34,43,64,34,60,36,39,23,36,52,25,31,68,52,47,46,31,19,40,24,50,44,56,43,46,44,28,43,35,28,36,36,26,67,32,28,32,52,52,34,40,52,47,40,31,52,30,35,52,42,35,39,28,39,26,44,75,59,40,18,22,60,39,67,64,18,43,35,26,19,60,62,36,47,44,28,46,31,25,30,36,48,32,44,25,46,40,54,43,32,40,18,38,32,43,32,59,35,72,44,18,44,50,18,28,62,24,46,30,44,52,64,44,23,34,44,75,58,44,28,46,18,75,18,46,26,38,34,75,20,34,56,60,55,18,43,52,39,56,75,38,24,36,46,18,44,66,59,66,56,32,43,44,35,32,56,19,42,54,25,48,38,36,36,58,39,48,54,32,52,36,44,72,18,28,38,32,71,31,60,55,35,32,36,75,40,60,44,24,36,35,58,35,24,58,63,18,40,47,42,40,36,30,67,18,28,70,18,48,35,42,42,59,48,19,48,38,48,18,63,40,36,60,18,32,60,44,48,39,39,48,52,59,28,19,54,46,43,36,56,40,48,20,36,34,27,30,18,36,20,40,40,66,44,34,22,51,34,36,22,40,44,39,48,44,22,35,18,44,35,44,18,50,40,36,32,35,51,34,43,64,35,68,56,52,58,44,44,46,34,28,18,43,24,26,34,36,39,54,28,66,47,44,28,44,59,52,27,52,34,39,22,27,40,54,32,50,39,67,47,32,40,38,40,18,23,42,28,39,32,51,30,48,44,64,44,18,18,48,34,26,32,63,36,48,28,34,28,32,38,35,58,52,56,47,38,27,38,52,59,54,44,66,60,31,56,64,44,24,26,48,40,48,40,18,56,28,52,48,44,56,27,26,35,42,40,18,18,51,32,52,75,60,47,67,23,39,28,52,32,21,44,42,44,54,44,59,50,39,21,62,28,32,38,46,39,63,42,43,34,44,38,46,42,70,21,50,63,26,19,30,38,44,18,54,30,50,44,32,30,55,26,48,26,50,67,39,75,44,44,48,52,22,66,38,50,44,20,54,52,68,75,27,31,47,35,22,47,18,43,18,44,60,18,59,25,50,39,36,48,66,59,39,40,35,31,21,36,62,42,58,36,44,32,40,48,51,21,48,36,46,32,39,40,23,60,36,25,18,60,39,22,48,36,30,32,18,18,56,18,63,46,43,52,54,36,28,70,52,62,18,18,18,32,47,20,36,42,18,38,66,70,59,46,43,51,38,28,44,48,52,68,38,64,50,56,70,18,31,58,54,40,38,42,58,25,54,35,42,22,62,27,20,52,36,31,18,46,64,22,31,46,40,72,27,28,34,32,26,60,30,21,18,40,54,55,20,42,36,40,47,38,58,18,19,40,54,70,55,48,20,39,47,35,27,40,36,38,24,32,18,55,51,54,40,63,48,19,28,55,18,48,40,55,36,38,18,21,38,46,50,28,26,62,24,34,52,36,40,44,68,44,67,50,34,60,32,18,18,36,18,18,44,56,55,62,43,19,48,44,58,58,66,47,56,72,60,60,24,42,52,32,18,35,68,64,46,40,28,50,18,32,51,52,43,26,58,32,27,43,44,20,39,21,52,44,64,32,50,56,19,48,72,32,34,56,18,35,32,64,58,68,52,39,36,58,40,39,64,30,48,39,28,48,44,18,56,40,63,56,70,50,66,40,28,32,39,42,39,36,25,42,72,31,56,36,35,26,28,19,50,39,56,60,39,59,54,48,36,40,18,40,58,48,52,18,35,34,43,36,47,30,30,20,42,46,42,72,43,46,32,18,66,74,47,30,25,27,36,64,35,40,59,54,67,68,18,56,68,40,44,51,40,32,44,52,18,52,70,36,31,55,39,34,56,27,58,64,47,36,28,23,48,75,60,56,40,35,40,59,28,44,38,30,26,43,35,34,28,64,20,23,36,58,39,54,47,19,31,48,44,48,38,18,27,58,39,35,27,70,63,25,38,40,46,25,31,32,50,32,55,34,39,18,43,22,36,46,48,68,18,42,21,20,40,50,44,34,44,64,34,43,24,43,30,20,18,38,40,42,27,38,19,25,28,42,18,56,47,50,30,55,47,75,28,18,26,36,32,48,74,47,40,40,39,18,35,58,44,42,32,40,32,31,47,63,50,74,44,55,40,75,40,32,36,27,60,54,62,68,42,60,59,36,60,52,39,27,18,34,18,42,47,63,75,48,40,52,18,51,52,18,59,19,30,35,30,40,44,47,23,56,28,71,18,58,52,22,56,75,34,48,68,48,62,36,35,18,20,54,52,26,40,25,36,32,48,32,50,31,40,39,42,48,72,31,35,24,43,23,36,59,62,40,60,36,50,44,50,58,56,71,59,19,48,44,52,27,60,35,50,54,55,58,44,26,47,18,50,18,32,18,48,43,56,58,32,59,36,67,52,42,18,27,72,50,44,36,44,36,56,63,68,42,27,23,40,44,75,64,21,52,59,18,31,36,40,40,46,18,28,48,32,24,43,56,75,59,60,47,56,31,36,23,72,36,34,52,18,35,63,48,60,38,63,25,39,58,60,54,63,27,52,28,40,43,47,71,62,38,27,60,38,50,34,48,23,63,74,36,48,50,46,47,26,46,72,35,75,56,60,30,74,19,46,44,54,43,43,28,44,28,51,54,67,60,28,26,36,52,51,32,36,18,72,40,67,27,20,27,52,60,44,42,19,75,27,55,32,35,40,28,36,42,56,52,32,52,32,36,34,52,52,31,72,20,46,36,48,40,56,32,18,43,32,26,18,56,35,56,18,36,32,38,44,44,30,48,50,50,36,64,63,26,36,64,42,40,50,64,56,51,34,40,24,36,52,40,39,47,32,36,30,58,18,46,48,31,46,40,32,30,34,32,46,35,28,18,31,20,28,56,31,56,51,50,47,54,72,18,18,55,44,18,46,50,71,39,36,56,75,32,44,67,23,26,40,22,43,28,34,42,18,34,32,46,47,50,20,43,20,48,23,22,67,35,18,35,63,50,44,36,52,28,44,40,58,44,31,40,18,19,27,43,46,32,28,51,18,40,64,71,52,18,42,38,28,39,51,32,32,52,40,48,72,27,48,48,27,46,56,39,18,52,32,52,36,42,68,32,44,30,40,48,36,21,21,74,64,62,75,55,25,28,30,36,43,18,52,18,32,28,40,59,52,51,34,44,66,44,28,47,52,38,38,51,56,58,59,63,46,52,36,18,64,22,58,34,48,36,75,42,50,32,24,46,47,36,43,47,50,32,30,40,56,24,31,18,25,75,36,54,63,39,47,68,52,46,40,50,36,46,60,36,55,54,34,59,48,18,40,54,60,43,52,58,38,39,60,38,28,38,28,35,32,31,42,47,51,38,23,68,36,60,48,36,44,31,50,54,30,19,47,24,35,50,18,55,36,36,32,34,40,42,39,44,48,40,28,30,47,18,34,46,19,24,52,40,43,21,64,71,46,36,18,44,47,40,18,40,51,52,44,52,42,63,48,46,32,39,28,59,40,56,31,18,18,52,48,51,26,39,36,39,28,27,31,35,50,52,58,40,46,56,32,54,39,38,24,35,18,59,60,39,28,40,47,62,18,39,59,38,55,55,60,48,56,43,75,40,43,22,60,47,22,58,55,67,38,43,60,19,18,18,52,35,18,39,42,67,44,36,44,24,31,74,39,46,44,40,44,52,64,55,44,44,18,39,31,31,55,51,50,47,62,48,47,44,35,36,36,46,40,40,44,27,26,21,39,48,40,23,18,19,75,34,34,39,39,70,52,44,18,26,18,59,24,55,64,46,44,51,42,34,40,28,23,50,62,34,36,35,18,18,75,21,40,39,39,39,28,31,43,25,52,18,32,23,38,56,51,43,26,71,28,44,48,25,28,42,46,25,18,32,48,52,30,70,28,24,58,67,38,70,59,36,64,38,38,44,56,40,66,32,58,51,72,21,18,32,30,55,58,32,64,56,72,72,46,27,44,36,19,42,56,18,18,34,44,56,28,36,34,28,56,18,64,42,35,38,25,28],"xaxis":"x","yaxis":"y","type":"histogram"},{"alignmentgroup":"True","boxpoints":"all","fillcolor":"rgba(255,255,255,0)","hoveron":"points","hovertemplate":"Wiek: %{x}\u003cbr\u003eUdzia\u0142: %{y:.2f}%","jitter":0,"legendgroup":"","line":{"color":"rgba(255,255,255,0)"},"marker":{"color":"#3498db","symbol":"line-ns-open"},"name":"","offsetgroup":"","showlegend":false,"x":[34,31,42,60,55,40,39,68,18,32,60,48,43,51,56,60,44,52,28,18,39,64,48,27,66,44,68,28,60,18,18,64,44,47,20,24,23,39,42,18,40,36,32,26,48,32,28,52,50,35,22,28,42,68,58,42,28,42,46,46,42,31,43,28,46,47,48,38,28,40,56,18,21,18,38,31,18,36,48,18,46,55,35,54,52,52,30,36,21,46,56,26,72,48,56,67,34,18,42,18,72,40,39,32,18,40,60,55,18,40,68,52,24,64,28,36,31,36,40,52,39,30,44,18,19,58,35,50,55,40,48,43,46,52,59,68,72,32,38,47,38,34,59,66,43,30,50,36,40,48,35,36,38,22,36,52,50,58,72,60,28,32,52,64,32,44,23,46,43,28,62,56,32,56,44,31,27,36,48,42,48,40,18,26,28,38,48,22,63,50,31,64,50,27,18,30,51,68,24,52,21,36,36,27,48,28,40,75,40,18,52,74,51,47,40,18,36,22,34,43,64,34,60,36,39,23,36,52,25,31,68,52,47,46,31,19,40,24,50,44,56,43,46,44,28,43,35,28,36,36,26,67,32,28,32,52,52,34,40,52,47,40,31,52,30,35,52,42,35,39,28,39,26,44,75,59,40,18,22,60,39,67,64,18,43,35,26,19,60,62,36,47,44,28,46,31,25,30,36,48,32,44,25,46,40,54,43,32,40,18,38,32,43,32,59,35,72,44,18,44,50,18,28,62,24,46,30,44,52,64,44,23,34,44,75,58,44,28,46,18,75,18,46,26,38,34,75,20,34,56,60,55,18,43,52,39,56,75,38,24,36,46,18,44,66,59,66,56,32,43,44,35,32,56,19,42,54,25,48,38,36,36,58,39,48,54,32,52,36,44,72,18,28,38,32,71,31,60,55,35,32,36,75,40,60,44,24,36,35,58,35,24,58,63,18,40,47,42,40,36,30,67,18,28,70,18,48,35,42,42,59,48,19,48,38,48,18,63,40,36,60,18,32,60,44,48,39,39,48,52,59,28,19,54,46,43,36,56,40,48,20,36,34,27,30,18,36,20,40,40,66,44,34,22,51,34,36,22,40,44,39,48,44,22,35,18,44,35,44,18,50,40,36,32,35,51,34,43,64,35,68,56,52,58,44,44,46,34,28,18,43,24,26,34,36,39,54,28,66,47,44,28,44,59,52,27,52,34,39,22,27,40,54,32,50,39,67,47,32,40,38,40,18,23,42,28,39,32,51,30,48,44,64,44,18,18,48,34,26,32,63,36,48,28,34,28,32,38,35,58,52,56,47,38,27,38,52,59,54,44,66,60,31,56,64,44,24,26,48,40,48,40,18,56,28,52,48,44,56,27,26,35,42,40,18,18,51,32,52,75,60,47,67,23,39,28,52,32,21,44,42,44,54,44,59,50,39,21,62,28,32,38,46,39,63,42,43,34,44,38,46,42,70,21,50,63,26,19,30,38,44,18,54,30,50,44,32,30,55,26,48,26,50,67,39,75,44,44,48,52,22,66,38,50,44,20,54,52,68,75,27,31,47,35,22,47,18,43,18,44,60,18,59,25,50,39,36,48,66,59,39,40,35,31,21,36,62,42,58,36,44,32,40,48,51,21,48,36,46,32,39,40,23,60,36,25,18,60,39,22,48,36,30,32,18,18,56,18,63,46,43,52,54,36,28,70,52,62,18,18,18,32,47,20,36,42,18,38,66,70,59,46,43,51,38,28,44,48,52,68,38,64,50,56,70,18,31,58,54,40,38,42,58,25,54,35,42,22,62,27,20,52,36,31,18,46,64,22,31,46,40,72,27,28,34,32,26,60,30,21,18,40,54,55,20,42,36,40,47,38,58,18,19,40,54,70,55,48,20,39,47,35,27,40,36,38,24,32,18,55,51,54,40,63,48,19,28,55,18,48,40,55,36,38,18,21,38,46,50,28,26,62,24,34,52,36,40,44,68,44,67,50,34,60,32,18,18,36,18,18,44,56,55,62,43,19,48,44,58,58,66,47,56,72,60,60,24,42,52,32,18,35,68,64,46,40,28,50,18,32,51,52,43,26,58,32,27,43,44,20,39,21,52,44,64,32,50,56,19,48,72,32,34,56,18,35,32,64,58,68,52,39,36,58,40,39,64,30,48,39,28,48,44,18,56,40,63,56,70,50,66,40,28,32,39,42,39,36,25,42,72,31,56,36,35,26,28,19,50,39,56,60,39,59,54,48,36,40,18,40,58,48,52,18,35,34,43,36,47,30,30,20,42,46,42,72,43,46,32,18,66,74,47,30,25,27,36,64,35,40,59,54,67,68,18,56,68,40,44,51,40,32,44,52,18,52,70,36,31,55,39,34,56,27,58,64,47,36,28,23,48,75,60,56,40,35,40,59,28,44,38,30,26,43,35,34,28,64,20,23,36,58,39,54,47,19,31,48,44,48,38,18,27,58,39,35,27,70,63,25,38,40,46,25,31,32,50,32,55,34,39,18,43,22,36,46,48,68,18,42,21,20,40,50,44,34,44,64,34,43,24,43,30,20,18,38,40,42,27,38,19,25,28,42,18,56,47,50,30,55,47,75,28,18,26,36,32,48,74,47,40,40,39,18,35,58,44,42,32,40,32,31,47,63,50,74,44,55,40,75,40,32,36,27,60,54,62,68,42,60,59,36,60,52,39,27,18,34,18,42,47,63,75,48,40,52,18,51,52,18,59,19,30,35,30,40,44,47,23,56,28,71,18,58,52,22,56,75,34,48,68,48,62,36,35,18,20,54,52,26,40,25,36,32,48,32,50,31,40,39,42,48,72,31,35,24,43,23,36,59,62,40,60,36,50,44,50,58,56,71,59,19,48,44,52,27,60,35,50,54,55,58,44,26,47,18,50,18,32,18,48,43,56,58,32,59,36,67,52,42,18,27,72,50,44,36,44,36,56,63,68,42,27,23,40,44,75,64,21,52,59,18,31,36,40,40,46,18,28,48,32,24,43,56,75,59,60,47,56,31,36,23,72,36,34,52,18,35,63,48,60,38,63,25,39,58,60,54,63,27,52,28,40,43,47,71,62,38,27,60,38,50,34,48,23,63,74,36,48,50,46,47,26,46,72,35,75,56,60,30,74,19,46,44,54,43,43,28,44,28,51,54,67,60,28,26,36,52,51,32,36,18,72,40,67,27,20,27,52,60,44,42,19,75,27,55,32,35,40,28,36,42,56,52,32,52,32,36,34,52,52,31,72,20,46,36,48,40,56,32,18,43,32,26,18,56,35,56,18,36,32,38,44,44,30,48,50,50,36,64,63,26,36,64,42,40,50,64,56,51,34,40,24,36,52,40,39,47,32,36,30,58,18,46,48,31,46,40,32,30,34,32,46,35,28,18,31,20,28,56,31,56,51,50,47,54,72,18,18,55,44,18,46,50,71,39,36,56,75,32,44,67,23,26,40,22,43,28,34,42,18,34,32,46,47,50,20,43,20,48,23,22,67,35,18,35,63,50,44,36,52,28,44,40,58,44,31,40,18,19,27,43,46,32,28,51,18,40,64,71,52,18,42,38,28,39,51,32,32,52,40,48,72,27,48,48,27,46,56,39,18,52,32,52,36,42,68,32,44,30,40,48,36,21,21,74,64,62,75,55,25,28,30,36,43,18,52,18,32,28,40,59,52,51,34,44,66,44,28,47,52,38,38,51,56,58,59,63,46,52,36,18,64,22,58,34,48,36,75,42,50,32,24,46,47,36,43,47,50,32,30,40,56,24,31,18,25,75,36,54,63,39,47,68,52,46,40,50,36,46,60,36,55,54,34,59,48,18,40,54,60,43,52,58,38,39,60,38,28,38,28,35,32,31,42,47,51,38,23,68,36,60,48,36,44,31,50,54,30,19,47,24,35,50,18,55,36,36,32,34,40,42,39,44,48,40,28,30,47,18,34,46,19,24,52,40,43,21,64,71,46,36,18,44,47,40,18,40,51,52,44,52,42,63,48,46,32,39,28,59,40,56,31,18,18,52,48,51,26,39,36,39,28,27,31,35,50,52,58,40,46,56,32,54,39,38,24,35,18,59,60,39,28,40,47,62,18,39,59,38,55,55,60,48,56,43,75,40,43,22,60,47,22,58,55,67,38,43,60,19,18,18,52,35,18,39,42,67,44,36,44,24,31,74,39,46,44,40,44,52,64,55,44,44,18,39,31,31,55,51,50,47,62,48,47,44,35,36,36,46,40,40,44,27,26,21,39,48,40,23,18,19,75,34,34,39,39,70,52,44,18,26,18,59,24,55,64,46,44,51,42,34,40,28,23,50,62,34,36,35,18,18,75,21,40,39,39,39,28,31,43,25,52,18,32,23,38,56,51,43,26,71,28,44,48,25,28,42,46,25,18,32,48,52,30,70,28,24,58,67,38,70,59,36,64,38,38,44,56,40,66,32,58,51,72,21,18,32,30,55,58,32,64,56,72,72,46,27,44,36,19,42,56,18,18,34,44,56,28,36,34,28,56,18,64,42,35,38,25,28],"xaxis":"x2","yaxis":"y2","type":"box"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Wiek klienta (w latach)"}},"yaxis":{"anchor":"x","domain":[0.0,0.8316],"title":{"text":"Udzia\u0142 procentowy klient\u00f3w"},"ticksuffix":"%"},"xaxis2":{"anchor":"y2","domain":[0.0,1.0],"matches":"x","showticklabels":false,"showgrid":true},"yaxis2":{"anchor":"x2","domain":[0.8416,1.0],"matches":"y2","showticklabels":false,"showline":false,"ticks":"","showgrid":false},"legend":{"tracegroupgap":0},"title":{"text":"Rozk\u0142ad wieku klient\u00f3w Space-U"},"barmode":"relative","bargap":0.1,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('40134195-0e4b-4800-8744-6e770fd66f91');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="c36e5e36" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> df_dob[<span class="st">'age'</span>].describe()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Budowanie bloku Markdown</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>analiza_markdown <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ss">### Kluczowe Statystyki Wieku</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;Poniższe dane charakteryzują typowego klienta Space-U pod względem wieku.&lt;/p&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;ul&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b&gt;Średni wiek:&lt;/b&gt; </span><span class="sc">{</span>stats[<span class="st">'mean'</span>]<span class="sc">:.1f}</span><span class="ss"> lat&lt;/li&gt;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b&gt;Mediana (wiek środkowy):&lt;/b&gt; </span><span class="sc">{</span>stats[<span class="st">'50%'</span>]<span class="sc">:.0f}</span><span class="ss"> lat&lt;/li&gt;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b&gt;Przedział wiekowy:&lt;/b&gt; od </span><span class="sc">{</span>stats[<span class="st">'min'</span>]<span class="sc">:.0f}</span><span class="ss"> do </span><span class="sc">{</span>stats[<span class="st">'max'</span>]<span class="sc">:.0f}</span><span class="ss"> lat&lt;/li&gt;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;li&gt;&lt;b&gt;Odchylenie standardowe:&lt;/b&gt; </span><span class="sc">{</span>stats[<span class="st">'std'</span>]<span class="sc">:.1f}</span><span class="ss"> lat&lt;/li&gt;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/ul&gt;</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;p&gt;&lt;b&gt;Wnioski biznesowe:&lt;/b&gt; Nasza baza klientów jest wyraźnie skoncentrowana wokół osób w wieku &lt;b&gt;od </span><span class="sc">{</span>stats[<span class="st">'25%'</span>]<span class="sc">:.0f}</span><span class="ss"> do </span><span class="sc">{</span>stats[<span class="st">'75%'</span>]<span class="sc">:.0f}</span><span class="ss"> lat&lt;/b&gt; (środkowe 50% klientów), co sugeruje, że nasza oferta najsilniej rezonuje z osobami o ustabilizowanej pozycji zawodowej i finansowej. Warto rozważyć stworzenie dedykowanych kampanii lub produktów skierowanych do młodszych i starszych grup demograficznych, które są obecnie słabiej reprezentowane.&lt;/p&gt;"""</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>display(Markdown(analiza_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="kluczowe-statystyki-wieku" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="kluczowe-statystyki-wieku">Kluczowe Statystyki Wieku</h3>
<p>
Poniższe dane charakteryzują typowego klienta Space-U pod względem wieku.
</p>
<ul>
<li>
<b>Średni wiek:</b> 41.7 lat
</li>
<li>
<b>Mediana (wiek środkowy):</b> 40 lat
</li>
<li>
<b>Przedział wiekowy:</b> od 18 do 75 lat
</li>
<li>
<b>Odchylenie standardowe:</b> 14.4 lat
</li>
</ul>
<p>
<b>Wnioski biznesowe:</b> Nasza baza klientów jest wyraźnie skoncentrowana wokół osób w wieku <b>od 31 do 52 lat</b> (środkowe 50% klientów), co sugeruje, że nasza oferta najsilniej rezonuje z osobami o ustabilizowanej pozycji zawodowej i finansowej. Warto rozważyć stworzenie dedykowanych kampanii lub produktów skierowanych do młodszych i starszych grup demograficznych, które są obecnie słabiej reprezentowane.
</p>
</section>
</div>
</section>
<section id="segmentacja-klientów-metodą-rfm" class="level2">
<h2 class="anchored" data-anchor-id="segmentacja-klientów-metodą-rfm">Segmentacja klientów metodą RFM</h2>
<p>Analiza RFM (Recency, Frequency, Monetary) to sprawdzona i potężna technika marketingowa służąca do segmentacji bazy klientów. Zamiast traktować wszystkich klientów jednakowo, grupujemy ich na podstawie ich zachowań transakcyjnych, odpowiadając na trzy kluczowe pytania:</p>
<ul>
<li><p><strong>Recency</strong> (Kiedy ostatnio podróżowali?) - Jak niedawno klient skorzystał z naszych usług? Im niższa wartość, tym lepiej.</p></li>
<li><p><strong>Frequency</strong> (Jak często podróżują?) - Jak często klient do nas wraca? Im wyższa wartość, tym lepiej.</p></li>
<li><p><strong>Monetary</strong> (Ile wydają?) - Jaka jest łączna wartość wszystkich transakcji danego klienta? Im wyższa wartość, tym lepiej.</p></li>
</ul>
<p>Dzięki tej analizie możemy zidentyfikować naszych najcenniejszych klientów (“Mistrzów”), tych, o których musimy zawalczyć (“Ryzykowni”), oraz tych, którzy dopiero rozpoczynają swoją przygodę ze Space-U (“Nowi Klienci”). To fundament pod budowę skutecznych, spersonalizowanych kampanii i strategii utrzymania klienta.</p>
<section id="rozkład-klientów-w-segmentach-rfm" class="level3">
<h3 class="anchored" data-anchor-id="rozkład-klientów-w-segmentach-rfm">Rozkład klientów w segmentach RFM</h3>
<p>Poniższy wykres przedstawia wielkość poszczególnych segmentów w naszej bazie klientów.</p>
<div id="3cfd65e4" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>today_real <span class="op">=</span> date.today()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>future_analysis_date <span class="op">=</span> today_real.replace(year<span class="op">=</span>today_real.year <span class="op">+</span> <span class="dv">100</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>analysis_date <span class="op">=</span> future_analysis_date.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>query_rfm <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="ss">WITH Monetary AS (</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="ss">        client_id,</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="ss">        SUM(amount) AS monetary_value</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM transactions</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE </span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="ss">        status = 'Completed' AND</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="ss">        transaction_date &lt;= '</span><span class="sc">{</span>analysis_date<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    GROUP BY client_id</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="ss">),</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="ss">RecencyFrequency AS (</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="ss">        p.client_id,</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="ss">        MAX(t.departure_datetime) AS last_trip_date,</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="ss">        COUNT(DISTINCT p.trip_id) AS frequency</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM trip_participants p</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN trips t ON p.trip_id = t.trip_id</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE </span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="ss">        t.departure_datetime &lt;= '</span><span class="sc">{</span>analysis_date<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    GROUP BY p.client_id</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="ss">)</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="ss">SELECT</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="ss">    c.client_id,</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    c.first_name,</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="ss">    c.last_name,</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="ss">    DATEDIFF('</span><span class="sc">{</span>analysis_date<span class="sc">}</span><span class="ss">', rf.last_trip_date) AS recency_days,</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="ss">    COALESCE(rf.frequency, 0) AS frequency,</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    COALESCE(m.monetary_value, 0) AS monetary</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="ss">FROM</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    clients c</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="ss">LEFT JOIN</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    RecencyFrequency rf ON c.client_id = rf.client_id</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="ss">LEFT JOIN</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    Monetary m ON c.client_id = m.client_id;</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>df_rfm <span class="op">=</span> pd.read_sql(query_rfm, engine)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>df_rfm.fillna({<span class="st">'recency_days'</span>: <span class="dv">9999</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>df_rfm[<span class="st">'R_score'</span>] <span class="op">=</span> <span class="dv">4</span> <span class="op">-</span> pd.qcut(df_rfm[<span class="st">'recency_days'</span>], q<span class="op">=</span><span class="dv">4</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>df_rfm[<span class="st">'F_score'</span>] <span class="op">=</span> pd.qcut(df_rfm[<span class="st">'frequency'</span>].rank(method<span class="op">=</span><span class="st">'first'</span>), q<span class="op">=</span><span class="dv">4</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">'drop'</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>df_rfm[<span class="st">'M_score'</span>] <span class="op">=</span> pd.qcut(df_rfm[<span class="st">'monetary'</span>].rank(method<span class="op">=</span><span class="st">'first'</span>), q<span class="op">=</span><span class="dv">4</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">'drop'</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>df_rfm <span class="op">=</span> df_rfm.astype({<span class="st">'R_score'</span>: <span class="st">'int64'</span>, <span class="st">'F_score'</span>: <span class="st">'int64'</span>, <span class="st">'M_score'</span>: <span class="st">'int64'</span>})</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_segment(row):</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">&gt;=</span> <span class="dv">4</span> <span class="kw">and</span> row[<span class="st">'F_score'</span>] <span class="op">&gt;=</span> <span class="dv">4</span>: </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Mistrzowie (Champions)'</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">and</span> row[<span class="st">'F_score'</span>] <span class="op">&gt;=</span> <span class="dv">3</span>: </span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Lojalni Klienci'</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">and</span> row[<span class="st">'F_score'</span>] <span class="op">&gt;=</span> <span class="dv">3</span>: </span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Ryzykowni (At Risk)'</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">&gt;=</span> <span class="dv">3</span> <span class="kw">and</span> row[<span class="st">'M_score'</span>] <span class="op">&gt;=</span> <span class="dv">4</span>: </span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Wieloryby (Big Spenders)'</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">==</span> <span class="dv">4</span> <span class="kw">and</span> row[<span class="st">'F_score'</span>] <span class="op">==</span> <span class="dv">1</span>: </span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Nowi Klienci'</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'R_score'</span>] <span class="op">&lt;=</span> <span class="dv">2</span> <span class="kw">and</span> row[<span class="st">'F_score'</span>] <span class="op">&lt;=</span> <span class="dv">2</span>: </span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Hibernujący'</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Pozostali'</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>df_rfm[<span class="st">'Segment'</span>] <span class="op">=</span> df_rfm.<span class="bu">apply</span>(assign_segment, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>segment_counts <span class="op">=</span> df_rfm[<span class="st">'Segment'</span>].value_counts()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e6ea77ff" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>segment_counts.index,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>segment_counts.values,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Rozkład klientów w segmentach RFM'</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'y'</span>: <span class="st">'Liczba Klientów'</span>, <span class="st">'x'</span>: <span class="st">'Segment'</span>},</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>segment_counts.values,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>segment_counts.index,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>px.colors.qualitative.Plotly</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>fig.update_layout(showlegend<span class="op">=</span><span class="va">False</span>,plot_bgcolor<span class="op">=</span><span class="st">'white'</span>, xaxis_tickangle<span class="op">=-</span><span class="dv">45</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="2a41449f-a778-47ba-8c77-cad9cf0b2f78" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("2a41449f-a778-47ba-8c77-cad9cf0b2f78")) {                    Plotly.newPlot(                        "2a41449f-a778-47ba-8c77-cad9cf0b2f78",                        [{"alignmentgroup":"True","hovertemplate":"color=Mistrzowie (Champions)\u003cbr\u003eSegment=%{x}\u003cbr\u003eLiczba Klient\u00f3w=%{y}\u003cbr\u003etext=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Mistrzowie (Champions)","marker":{"color":"#636EFA","pattern":{"shape":""}},"name":"Mistrzowie (Champions)","offsetgroup":"Mistrzowie (Champions)","orientation":"v","showlegend":true,"text":[500.0],"textposition":"outside","x":["Mistrzowie (Champions)"],"xaxis":"x","y":[500],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"color=Lojalni Klienci\u003cbr\u003eSegment=%{x}\u003cbr\u003eLiczba Klient\u00f3w=%{y}\u003cbr\u003etext=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Lojalni Klienci","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"Lojalni Klienci","offsetgroup":"Lojalni Klienci","orientation":"v","showlegend":true,"text":[500.0],"textposition":"outside","x":["Lojalni Klienci"],"xaxis":"x","y":[500],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"color=Pozostali\u003cbr\u003eSegment=%{x}\u003cbr\u003eLiczba Klient\u00f3w=%{y}\u003cbr\u003etext=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Pozostali","marker":{"color":"#00CC96","pattern":{"shape":""}},"name":"Pozostali","offsetgroup":"Pozostali","orientation":"v","showlegend":true,"text":[497.0],"textposition":"outside","x":["Pozostali"],"xaxis":"x","y":[497],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"color=Nowi Klienci\u003cbr\u003eSegment=%{x}\u003cbr\u003eLiczba Klient\u00f3w=%{y}\u003cbr\u003etext=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Nowi Klienci","marker":{"color":"#AB63FA","pattern":{"shape":""}},"name":"Nowi Klienci","offsetgroup":"Nowi Klienci","orientation":"v","showlegend":true,"text":[495.0],"textposition":"outside","x":["Nowi Klienci"],"xaxis":"x","y":[495],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"color=Wieloryby (Big Spenders)\u003cbr\u003eSegment=%{x}\u003cbr\u003eLiczba Klient\u00f3w=%{y}\u003cbr\u003etext=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Wieloryby (Big Spenders)","marker":{"color":"#FFA15A","pattern":{"shape":""}},"name":"Wieloryby (Big Spenders)","offsetgroup":"Wieloryby (Big Spenders)","orientation":"v","showlegend":true,"text":[8.0],"textposition":"outside","x":["Wieloryby (Big Spenders)"],"xaxis":"x","y":[8],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Segment"},"tickangle":-45},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Liczba Klient\u00f3w"}},"legend":{"title":{"text":"color"},"tracegroupgap":0},"title":{"text":"Rozk\u0142ad klient\u00f3w w segmentach RFM"},"barmode":"relative","showlegend":false,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('2a41449f-a778-47ba-8c77-cad9cf0b2f78');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="d16889aa" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>segment_counts <span class="op">=</span> df_rfm[<span class="st">'Segment'</span>].value_counts()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>total_clients <span class="op">=</span> <span class="bu">len</span>(df_rfm)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>recommendations <span class="op">=</span> {</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mistrzowie (Champions)'</span>: </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"To Twoi najcenniejsi klienci. Angażuj ich, proś o opinie i recenzje, "</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"zaoferuj programy lojalnościowe i dostęp do ekskluzywnych ofert. "</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Są ambasadorami Twojej marki."</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Lojalni Klienci'</span>: </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Są kręgosłupem Twojej firmy. Podtrzymuj ich zaangażowanie, oferując "</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nowe produkty (cross-selling), lepsze wersje wypraw (up-selling) "</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"i budując z nimi długotrwałą relację."</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ryzykowni (At Risk)'</span>: </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"KLUCZOWA GRUPA DO REAKTYWACJI! To byli dobrzy klienci, którzy dawno "</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nic nie kupili. Skontaktuj się z nimi osobiście, zaoferuj spersonalizowaną "</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"zniżkę 'na powrót' i dowiedz się, dlaczego przestali podróżować."</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Wieloryby (Big Spenders)'</span>:</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Wydają dużo, ale niekoniecznie często. Upewnij się, że są zadowoleni "</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"z jakości usług. Mogą być podatni na oferty konkurencji. Warto zadbać "</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"o ich satysfakcję."</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nowi Klienci'</span>:</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pierwsze wrażenie jest kluczowe. Zapewnij im doskonałe doświadczenie "</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"na pokładzie i stwórz spersonalizowaną ścieżkę komunikacji (np. seria maili), "</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"aby zachęcić ich do drugiej podróży i zamienić w lojalnych klientów."</span>,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Hibernujący'</span>:</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Duża grupa nieaktywnych klientów. Jeśli ich liczba jest znacząca, rozważ "</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"szeroko zakrojoną, ale niskokosztową kampanię 'Tęsknimy za Tobą!' z atrakcyjną "</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ofertą. Nie inwestuj w nich tyle, co w segment 'Ryzykowni'."</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c72fdc61" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rekomendacje_markdown <span class="op">=</span> <span class="st">"### Kluczowe Segmenty i Rekomendacje Strategiczne</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># W pętli tworzymy osobny blok "Callout" dla każdego segmentu</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> segment, count <span class="kw">in</span> segment_counts.items():</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> segment <span class="kw">in</span> recommendations:</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        percentage <span class="op">=</span> (count <span class="op">/</span> total_clients) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tworzymy blok "Callout" w składni Quarto Markdown</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ważne: Całość jest w jednym f-stringu bez wcięć, aby uniknąć błędów formatowania</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        rekomendacje_markdown <span class="op">+=</span> <span class="ss">f"""</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.callout-note icon=false</span><span class="ch">}}</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="ss">#### </span><span class="sc">{</span>segment<span class="sc">}</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="ss">**</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> klientów** (</span><span class="sc">{</span>percentage<span class="sc">:.1f}</span><span class="ss">% wszystkich)</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="ss">**Rekomendacja strategiczna:** </span><span class="sc">{</span>recommendations[segment]<span class="sc">}</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>display(Markdown(rekomendacje_markdown))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="kluczowe-segmenty-i-rekomendacje-strategiczne" class="level3 cell-output cell-output-display cell-output-markdown">
<h3 class="anchored" data-anchor-id="kluczowe-segmenty-i-rekomendacje-strategiczne">Kluczowe Segmenty i Rekomendacje Strategiczne</h3>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mistrzowie (Champions)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>500 klientów</strong> (25.0% wszystkich)</p>
<p><strong>Rekomendacja strategiczna:</strong> To Twoi najcenniejsi klienci. Angażuj ich, proś o opinie i recenzje, zaoferuj programy lojalnościowe i dostęp do ekskluzywnych ofert. Są ambasadorami Twojej marki.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lojalni Klienci
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>500 klientów</strong> (25.0% wszystkich)</p>
<p><strong>Rekomendacja strategiczna:</strong> Są kręgosłupem Twojej firmy. Podtrzymuj ich zaangażowanie, oferując nowe produkty (cross-selling), lepsze wersje wypraw (up-selling) i budując z nimi długotrwałą relację.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nowi Klienci
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>495 klientów</strong> (24.8% wszystkich)</p>
<p><strong>Rekomendacja strategiczna:</strong> Pierwsze wrażenie jest kluczowe. Zapewnij im doskonałe doświadczenie na pokładzie i stwórz spersonalizowaną ścieżkę komunikacji (np. seria maili), aby zachęcić ich do drugiej podróży i zamienić w lojalnych klientów.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Wieloryby (Big Spenders)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>8 klientów</strong> (0.4% wszystkich)</p>
<p><strong>Rekomendacja strategiczna:</strong> Wydają dużo, ale niekoniecznie często. Upewnij się, że są zadowoleni z jakości usług. Mogą być podatni na oferty konkurencji. Warto zadbać o ich satysfakcję.</p>
</div>
</div>
</section>
</div>
</section>
</section>
<section id="wyprawy-odpychające-i-przyciągające" class="level2">
<h2 class="anchored" data-anchor-id="wyprawy-odpychające-i-przyciągające">Wyprawy odpychające i przyciągające</h2>
<p>W tej sekcji analizujemy wyprawy, po których klienci najchętniej wracają oraz wyprawy po których już więcej ich nie widzimy. Rozbijemy ten problem na trzy części, by mieć lepszy wgląd w sytuację. Na początek przyjrzymy się wyprawom, na których było najwięcej klientów, co pojechali tylko raz. Chcemy się dowiedzieć, jakie wyprawy poległy w wywarciu dobrego wrażenia na nowych klientach. Otrzymamy informację o cechach wyprawy, a później spojrzymy które z tych cech występują najczęściej. Od góry będziemy wypisywać te loty, co miały najwięcej jednorazowych klientów.</p>
<div id="ec0e8e83" class="cell" data-execution_count="64">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>query_one_timers <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="st">        client_id, </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(trip_id) as trips </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM  trip_participants </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY client_id</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="st">    HAVING trips = 1</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>df_one_time <span class="op">=</span> pd.read_sql_query(text(query_one_timers), engine)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>client_ids <span class="op">=</span> df_one_time[<span class="st">'client_id'</span>].tolist()</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: podróże tych klientów ---</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> client_ids:</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    one_time_trips <span class="op">=</span> []</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> <span class="st">','</span>.join([<span class="st">':id'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(client_ids))])</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    param_dict <span class="op">=</span> {<span class="ss">f'id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>: cid <span class="cf">for</span> i, cid <span class="kw">in</span> <span class="bu">enumerate</span>(client_ids)}</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    query_one_time_trips <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT trip_id, COUNT(*) as count</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM trip_participants</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE client_id IN (</span><span class="sc">{</span>placeholders<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY trip_id</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="ss">        ORDER BY count DESC</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    df_trips <span class="op">=</span> pd.read_sql_query(text(query_one_time_trips), engine, params<span class="op">=</span>param_dict)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    trip_ids <span class="op">=</span> df_trips[<span class="st">'trip_id'</span>].tolist()</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 3: szczegóły podróży ---</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> trip_ids:</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    df_disliked_trips <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>])</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> <span class="st">','</span>.join([<span class="st">':id'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trip_ids))])</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    param_dict <span class="op">=</span> {<span class="ss">f'id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>: tid <span class="cf">for</span> i, tid <span class="kw">in</span> <span class="bu">enumerate</span>(trip_ids)}</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    query_trip_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT </span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="ss">            d.name AS destination,</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="ss">            tt.name AS trip_type,</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="ss">            s.name AS spacecraft_name,</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="ss">            r.name AS rocket_name,</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="ss">            t.trip_id</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM trip_participants tp</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trips t ON tp.trip_id = t.trip_id</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN spacecraft s ON t.spacecraft_id = s.spacecraft_id</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN rockets r ON t.rocket_id = r.rocket_id</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN destinations d ON t.destination_id = d.destination_id</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trip_types tt ON t.trip_type_id = tt.trip_type_id</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE tp.trip_id IN (</span><span class="sc">{</span>placeholders<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY t.trip_id, d.name, tt.name</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    df_disliked_trips <span class="op">=</span> pd.read_sql_query(text(query_trip_info), engine, params<span class="op">=</span>param_dict)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Formatowanie końcowe ---</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>df_disliked_trips.columns <span class="op">=</span> [<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>]</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>df_disliked_trips.index <span class="op">=</span> pd.RangeIndex(start<span class="op">=</span><span class="dv">1</span>, stop<span class="op">=</span><span class="bu">len</span>(df_disliked_trips)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Wyświetlenie wyników</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>display(df_disliked_trips.head(<span class="dv">10</span>))</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>df_summary_markdown(df_disliked_trips.head(<span class="dv">10</span>))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Planeta</th>
<th data-quarto-table-cell-role="th">Typ wyprawy</th>
<th data-quarto-table-cell-role="th">Pojazd</th>
<th data-quarto-table-cell-role="th">Rakieta</th>
<th data-quarto-table-cell-role="th">Id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Mars</td>
<td>Przygoda Atmosferyczna</td>
<td>Vortex-One</td>
<td>Cyclone-Ultra</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Wenus</td>
<td>Przelot Przez Pole Promieniowania</td>
<td>Eclipse-Prime</td>
<td>Vega-Ultra</td>
<td>95</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
Podsumowanie
<p>
🔸 Wszystkie planety występują równie często.
</p>
<p>
🔸 Wszystkie rodzaje wycieczek występują równie często.
</p>
<p>
🔸 Wszystkie pojazdy kosmiczne występują równie często.
</p>
</div>
</div>
<p>Teraz zbadamy wyprawy, które zniechęciły klientów, którzy już kilka razy z nami latali. To da nam informację, jakie typy wypraw zmęczyły lub znudziły naszych pasażerów.</p>
<div id="1ac68833" class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>one_time_ids <span class="op">=</span> df_one_time[<span class="st">'client_id'</span>].tolist()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> one_time_ids:</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"client_id"</span>, <span class="st">"trip_id"</span>])</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    one_time_ids <span class="op">=</span> [<span class="bu">int</span>(t) <span class="cf">for</span> t <span class="kw">in</span> one_time_ids]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> <span class="st">','</span>.join([<span class="ss">f':id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(one_time_ids))])</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    param_dict <span class="op">=</span> {<span class="ss">f'id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>: val <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(one_time_ids)}</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    query_last_trips <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="ss">        tp.client_id,</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="ss">        t.trip_id</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="ss">        trip_participants tp</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="ss">    JOIN trips t ON tp.trip_id = t.trip_id</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="ss">        tp.client_id NOT IN (</span><span class="sc">{</span>placeholders<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="ss">        AND t.departure_datetime = (</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="ss">            SELECT MAX(t2.departure_datetime)</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="ss">            FROM trip_participants tp2</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="ss">            JOIN trips t2 ON tp2.trip_id = t2.trip_id</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="ss">            WHERE tp2.client_id = tp.client_id</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="ss">        )</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    ORDER BY tp.client_id</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_sql_query(text(query_last_trips), engine, params<span class="op">=</span>param_dict)</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: Zlicz podróże i sortuj ---</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> df[<span class="st">'trip_id'</span>].value_counts().reset_index()</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>summary.columns <span class="op">=</span> [<span class="st">'trip_id'</span>, <span class="st">'num_clients'</span>]</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> summary.sort_values(by<span class="op">=</span><span class="st">'num_clients'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>last_trips_ids <span class="op">=</span> summary[<span class="st">"trip_id"</span>].tolist()</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 3: Szczegóły podróży ---</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> last_trips_ids:</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    df_last_trips <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>])</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> <span class="st">','</span>.join([<span class="ss">f':id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(last_trips_ids))])</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    param_dict <span class="op">=</span> {<span class="ss">f'id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>: tid <span class="cf">for</span> i, tid <span class="kw">in</span> <span class="bu">enumerate</span>(last_trips_ids)}</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    query_trip_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT </span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="ss">            d.name AS destination,</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="ss">            tt.name AS trip_type,</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="ss">            s.name AS spacecraft_name,</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="ss">            r.name AS rocket_name,</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="ss">            t.trip_id</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM trip_participants tp</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trips t ON tp.trip_id = t.trip_id</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN spacecraft s ON t.spacecraft_id = s.spacecraft_id</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN rockets r ON t.rocket_id = r.rocket_id</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN destinations d ON t.destination_id = d.destination_id</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trip_types tt ON t.trip_type_id = tt.trip_type_id</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE tp.trip_id IN (</span><span class="sc">{</span>placeholders<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY t.trip_id, d.name, tt.name</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    df_last_trips <span class="op">=</span> pd.read_sql_query(text(query_trip_info), engine, params<span class="op">=</span>param_dict)</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Formatowanie końcowe ---</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>df_last_trips.columns <span class="op">=</span> [<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>]</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>df_last_trips.index <span class="op">=</span> pd.RangeIndex(start<span class="op">=</span><span class="dv">1</span>, stop<span class="op">=</span><span class="bu">len</span>(df_last_trips)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Wyświetlenie wyników</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>display(df_last_trips.head(<span class="dv">10</span>))</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>df_summary_markdown(df_last_trips.head(<span class="dv">10</span>))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Planeta</th>
<th data-quarto-table-cell-role="th">Typ wyprawy</th>
<th data-quarto-table-cell-role="th">Pojazd</th>
<th data-quarto-table-cell-role="th">Rakieta</th>
<th data-quarto-table-cell-role="th">Id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Mars</td>
<td>Wycieczka Orbitalna</td>
<td>Hyperion-Edge</td>
<td>Vega-Edge</td>
<td>31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Merkury</td>
<td>Baza Kosmiczna - Pobyt</td>
<td>Nova-One</td>
<td>Atlas-Edge</td>
<td>53</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Merkury</td>
<td>Przelot Przez Pole Promieniowania</td>
<td>Hyperion-Infinity</td>
<td>Cyclone-Pro</td>
<td>59</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Saturn</td>
<td>Przelot Przez Pole Promieniowania</td>
<td>Vortex-Ultra</td>
<td>Cyclone-Ultra</td>
<td>61</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Mars</td>
<td>Manewry Orbitalne</td>
<td>Luna-One</td>
<td>Atlas-Edge</td>
<td>65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Saturn</td>
<td>Manewry Orbitalne</td>
<td>Zenith-One</td>
<td>Delta-V</td>
<td>79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Jowisz</td>
<td>Eksploracja Magnetosfery</td>
<td>Zenith-Ultra</td>
<td>Falcon-Ultra</td>
<td>90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Wenus</td>
<td>Baza Kosmiczna - Pobyt</td>
<td>Vortex-Ultra</td>
<td>Strato-Edge</td>
<td>94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Wenus</td>
<td>Widokowe Obserwacje Nieba</td>
<td>Vortex-One</td>
<td>Falcon-R</td>
<td>97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Merkury</td>
<td>Eksploracja Magnetosfery</td>
<td>Zenith-Ultra</td>
<td>Talon-Max</td>
<td>100</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
Podsumowanie
<p>
🌍 Najczęściej występująca planeta to <b>Merkury</b> z liczbą <b>3</b> wypraw.
</p>
<p>
🧭 Najczęstszy rodzaj wycieczki to <b>Baza Kosmiczna - Pobyt</b> (2 razy).
</p>
<p>
🚀 Najczęściej używany pojazd kosmiczny to <b>Vortex-Ultra</b> (użyty 2 razy).
</p>
</div>
</div>
<p>Mamy już omówione te negatywne loty. Pora zatem sprawdzić, po których wyprawach klienci wracają po więcej. To nam pokaże, które loty zostawić w ofercie. W poniższym podsumowaniu bierzemy pod uwagę tylko te wyprawy, po których klienci wrócili i odbyli kolejną wyprawę. Od góry będziemy wypisywać te, które miały najwięcej powracających klientów.</p>
<div id="6811e9d3" class="cell" data-execution_count="66">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT tp.client_id, tp.trip_id, t.departure_datetime </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM trip_participants tp</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN trips t ON tp.trip_id = t.trip_id</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY tp.client_id, t.departure_datetime</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: Analiza powrotów klientów ---</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'next_trip'</span>] <span class="op">=</span> df.groupby(<span class="st">'client_id'</span>)[<span class="st">'trip_id'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'returned_after'</span>] <span class="op">=</span> df[<span class="st">'next_trip'</span>].notna()</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>trip_retention <span class="op">=</span> df[df[<span class="st">'returned_after'</span>]].groupby(<span class="st">'trip_id'</span>).size().reset_index(name<span class="op">=</span><span class="st">'clients_returned'</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>trip_retention <span class="op">=</span> trip_retention.sort_values(by<span class="op">=</span><span class="st">'clients_returned'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>top_5_ret_ids <span class="op">=</span> trip_retention.head(<span class="dv">10</span>)[<span class="st">"trip_id"</span>].tolist()</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 3: Szczegóły dla najczęściej powracanych podróży ---</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> top_5_ret_ids:</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    df_liked_trips <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>])</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> <span class="st">','</span>.join([<span class="ss">f':id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(top_5_ret_ids))])</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    param_dict <span class="op">=</span> {<span class="ss">f'id</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>: tid <span class="cf">for</span> i, tid <span class="kw">in</span> <span class="bu">enumerate</span>(top_5_ret_ids)}</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="ss">        SELECT </span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="ss">            d.name AS destination,</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="ss">            tt.name AS trip_type,</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="ss">            s.name AS spacecraft_name,</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="ss">            r.name AS rocket_name,</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="ss">            t.trip_id</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="ss">        FROM trip_participants tp</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trips t ON tp.trip_id = t.trip_id</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN spacecraft s ON t.spacecraft_id = s.spacecraft_id</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN rockets r ON t.rocket_id = r.rocket_id</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN destinations d ON t.destination_id = d.destination_id</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="ss">        JOIN trip_types tt ON t.trip_type_id = tt.trip_type_id</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="ss">        WHERE tp.trip_id IN (</span><span class="sc">{</span>placeholders<span class="sc">}</span><span class="ss">)</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="ss">        GROUP BY t.trip_id, d.name, tt.name</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    df_liked_trips <span class="op">=</span> pd.read_sql_query(text(query), engine, params<span class="op">=</span>param_dict)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Formatowanie i wyświetlenie ---</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>df_liked_trips.columns <span class="op">=</span> [<span class="st">"Planeta"</span>, <span class="st">"Typ wyprawy"</span>, <span class="st">"Pojazd"</span>, <span class="st">"Rakieta"</span>, <span class="st">"Id"</span>]</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>df_liked_trips.index <span class="op">=</span> pd.RangeIndex(start<span class="op">=</span><span class="dv">1</span>, stop<span class="op">=</span><span class="bu">len</span>(df_liked_trips)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>display(df_liked_trips.head(<span class="dv">10</span>))</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>df_summary_markdown(df_liked_trips)</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Planeta</th>
<th data-quarto-table-cell-role="th">Typ wyprawy</th>
<th data-quarto-table-cell-role="th">Pojazd</th>
<th data-quarto-table-cell-role="th">Rakieta</th>
<th data-quarto-table-cell-role="th">Id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Mars</td>
<td>Baza Kosmiczna - Pobyt</td>
<td>Nova-Prime</td>
<td>Delta-V</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Merkury</td>
<td>Baza Kosmiczna - Pobyt</td>
<td>Nova-Prime</td>
<td>Atlas-Pro</td>
<td>15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Wenus</td>
<td>Wyprawa Powierzchniowa</td>
<td>Vortex-One</td>
<td>Delta-V</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Merkury</td>
<td>Eksploracja Magnetosfery</td>
<td>Hyperion-Infinity</td>
<td>Talon-Max</td>
<td>41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Merkury</td>
<td>Manewry Orbitalne</td>
<td>Vortex-One</td>
<td>Atlas-Pro</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Wenus</td>
<td>Baza Kosmiczna - Pobyt</td>
<td>Eclipse-Infinity</td>
<td>Falcon-V</td>
<td>56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Wenus</td>
<td>Wyprawa Powierzchniowa</td>
<td>Hyperion-Infinity</td>
<td>Strato-Edge</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Jowisz</td>
<td>Wyprawa Powierzchniowa</td>
<td>Hyperion-Infinity</td>
<td>Falcon-Ultra</td>
<td>62</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Mars</td>
<td>Widokowe Obserwacje Nieba</td>
<td>Eclipse-Infinity</td>
<td>Delta-1000</td>
<td>72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Merkury</td>
<td>Wycieczka Orbitalna</td>
<td>Eclipse-Infinity</td>
<td>Zephyr-Eon</td>
<td>99</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
Podsumowanie
<p>
🌍 Najczęściej występująca planeta to <b>Merkury</b> z liczbą <b>4</b> wypraw.
</p>
<p>
🧭 Najczęstszy rodzaj wycieczki to <b>Baza Kosmiczna - Pobyt</b> (3 razy).
</p>
<p>
🚀 Najczęściej używany pojazd kosmiczny to <b>Eclipse-Infinity</b> (użyty 3 razy).
</p>
</div>
</div>
<p>Mamy teraz przegląd najbardziej wpływowych lotów. Pytanie teraz brzmi, które zostawiamy, a których należy się pozbyć?</p>
</section>
<section id="odnalezienie-najlepiej-ocenianego-oraz-najaktywniejszego-pracownika" class="level2">
<h2 class="anchored" data-anchor-id="odnalezienie-najlepiej-ocenianego-oraz-najaktywniejszego-pracownika">Odnalezienie najlepiej ocenianego oraz najaktywniejszego pracownika</h2>
<p>Interesuje nas wpływ naszych pracowników na wyprawy. Chcemy odnaleźć pracownika, który ma najlepszy wpływ na ocenę lotów. Będziemy się głównie skupiać na tych rolach, które mając bezpośredni kontakt z pasażerami lub bezpośrednio wpływają na komfort podróży (np. Pilot, Kucharz). Dalej będziemy chcieli odnaleźć najaktywniejszego pracownika, czyli tego który został przypisany do największej liczby wypraw. Chcemy tutaj znaleźć tego, który najwięcej wnosi do naszych lotów i będziemy tu już badać wszystkie role.</p>
<section id="najlepiej-oceniani-pracownicy" class="level4">
<h4 class="anchored" data-anchor-id="najlepiej-oceniani-pracownicy">Najlepiej oceniani pracownicy</h4>
<div id="365141bc" class="cell" data-execution_count="67">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>roles_of_interest <span class="op">=</span> [<span class="st">"Pilot statku"</span>, <span class="st">"Specjalista ds. bezpieczeństwa"</span>,<span class="st">"Lekarz pokładowy"</span>, <span class="st">"Kucharz orbitalny"</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 1: Pobranie ocen przypisanych pracownikom ---</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="st">    e.first_name AS Imię,</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="st">    e.last_name AS Nazwisko,</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="st">    e.position AS Pozycja,</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="st">    f.trip_id,</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="st">    ea.employee_id AS ID,</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="st">    f.rating AS Ocena</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="st">FROM employee_assignments ea</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN employees e ON ea.employee_id = e.employee_id</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN feedback f ON ea.trip_id = f.trip_id</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>df_ratings_all <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: Średnie oceny wszystkich pracowników ---</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>avg_ratings_all <span class="op">=</span> df_ratings_all.groupby([<span class="st">'Imię'</span>, <span class="st">'Nazwisko'</span>, <span class="st">'Pozycja'</span>,<span class="st">'ID'</span>])[<span class="st">'Ocena'</span>].mean().reset_index()</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>avg_ratings_all[<span class="st">"Ocena"</span>] <span class="op">=</span> <span class="bu">round</span>(avg_ratings_all[<span class="st">"Ocena"</span>], <span class="dv">2</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>avg_ratings_all <span class="op">=</span> avg_ratings_all.sort_values(by<span class="op">=</span><span class="st">"Ocena"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 3: Średnie oceny tylko dla interesujących nas ról ---</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>roles_of_interest <span class="op">=</span> [<span class="st">"Pilot statku"</span>, <span class="st">"Specjalista ds. bezpieczeństwa"</span>, <span class="st">"Lekarz pokładowy"</span>, <span class="st">"Kucharz orbitalny"</span>]</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>df_ratings_interest <span class="op">=</span> df_ratings_all[df_ratings_all[<span class="st">"Pozycja"</span>].isin(roles_of_interest)]</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>avg_ratings_interest <span class="op">=</span> df_ratings_interest.groupby([<span class="st">'Imię'</span>, <span class="st">'Nazwisko'</span>, <span class="st">'Pozycja'</span>,<span class="st">'ID'</span>])[<span class="st">'Ocena'</span>].mean().reset_index()</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>avg_ratings_interest[<span class="st">"Ocena"</span>] <span class="op">=</span> <span class="bu">round</span>(avg_ratings_interest[<span class="st">"Ocena"</span>], <span class="dv">2</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>avg_ratings_interest <span class="op">=</span> avg_ratings_interest.sort_values(by<span class="op">=</span><span class="st">"Ocena"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Wyświetlenie topowych ---</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>display(avg_ratings_interest.head(<span class="dv">5</span>).style.hide(axis<span class="op">=</span><span class="st">"index"</span>))</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Markdown z najlepszym pracownikiem ---</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>best_employee <span class="op">=</span> avg_ratings_interest.iloc[<span class="dv">0</span>]</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>markmarkdown_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="ss">👨‍🚀 Najlepszym pracownikiem okazał jest **</span><span class="sc">{</span>best_employee[<span class="st">'Imię'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>best_employee[<span class="st">'Nazwisko'</span>]<span class="sc">}</span><span class="ss">** o ID **</span><span class="sc">{</span>best_employee[<span class="st">'ID'</span>]<span class="sc">}</span><span class="ss">** , który przysłużył nam się pracując jako **</span><span class="sc">{</span>best_employee[<span class="st">'Pozycja'</span>]<span class="sc">}</span><span class="ss">**. Uzyskana ocena wynosi **</span><span class="sc">{</span>best_employee[<span class="st">'Ocena'</span>]<span class="sc">}</span><span class="ss">**.</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>display(Markdown(markmarkdown_text))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_61621" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_61621_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Imię</th>
<th id="T_61621_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Nazwisko</th>
<th id="T_61621_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Pozycja</th>
<th id="T_61621_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">ID</th>
<th id="T_61621_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Ocena</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_61621_row0_col0" class="data row0 col0">Michał</td>
<td id="T_61621_row0_col1" class="data row0 col1">Apanowicz</td>
<td id="T_61621_row0_col2" class="data row0 col2">Pilot statku</td>
<td id="T_61621_row0_col3" class="data row0 col3">274</td>
<td id="T_61621_row0_col4" class="data row0 col4">4.580000</td>
</tr>
<tr class="even">
<td id="T_61621_row1_col0" class="data row1 col0">Mikołaj</td>
<td id="T_61621_row1_col1" class="data row1 col1">Barej</td>
<td id="T_61621_row1_col2" class="data row1 col2">Specjalista ds. bezpieczeństwa</td>
<td id="T_61621_row1_col3" class="data row1 col3">248</td>
<td id="T_61621_row1_col4" class="data row1 col4">4.530000</td>
</tr>
<tr class="odd">
<td id="T_61621_row2_col0" class="data row2 col0">Kalina</td>
<td id="T_61621_row2_col1" class="data row2 col1">Osiadacz</td>
<td id="T_61621_row2_col2" class="data row2 col2">Lekarz pokładowy</td>
<td id="T_61621_row2_col3" class="data row2 col3">222</td>
<td id="T_61621_row2_col4" class="data row2 col4">4.480000</td>
</tr>
<tr class="even">
<td id="T_61621_row3_col0" class="data row3 col0">Julian</td>
<td id="T_61621_row3_col1" class="data row3 col1">Pupek</td>
<td id="T_61621_row3_col2" class="data row3 col2">Kucharz orbitalny</td>
<td id="T_61621_row3_col3" class="data row3 col3">192</td>
<td id="T_61621_row3_col4" class="data row3 col4">4.470000</td>
</tr>
<tr class="odd">
<td id="T_61621_row4_col0" class="data row4 col0">Krystian</td>
<td id="T_61621_row4_col1" class="data row4 col1">Michalczak</td>
<td id="T_61621_row4_col2" class="data row4 col2">Lekarz pokładowy</td>
<td id="T_61621_row4_col3" class="data row4 col3">176</td>
<td id="T_61621_row4_col4" class="data row4 col4">4.450000</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>👨‍🚀 Najlepszym pracownikiem okazał jest <strong>Michał Apanowicz</strong> o ID <strong>274</strong> , który przysłużył nam się pracując jako <strong>Pilot statku</strong>. Uzyskana ocena wynosi <strong>4.58</strong>.</p>
</div>
</div>
</section>
<section id="najaktywniejsi-pracownicy" class="level4">
<h4 class="anchored" data-anchor-id="najaktywniejsi-pracownicy">Najaktywniejsi pracownicy</h4>
<div id="ec78f0f2" class="cell" data-execution_count="68">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="st">    e.first_name AS Imię,</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="st">    e.last_name AS Nazwisko,</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="st">    e.position AS Pozycja,</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="st">    ea.employee_id AS ID,</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(ea.trip_id) AS Wyprawy</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM employee_assignments ea</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN employees e ON ea.employee_id = e.employee_id</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY ea.employee_id, e.first_name, e.last_name, e.position</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY Wyprawy DESC</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>df_acvitivy <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: Filtrowanie po interesujących rolach ---</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>df_acvitivy_interest <span class="op">=</span> df_acvitivy[df_acvitivy[<span class="st">"Pozycja"</span>].isin(roles_of_interest)]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 3: Sortowanie i wyświetlanie ---</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>most_active <span class="op">=</span> df_acvitivy.sort_values(by<span class="op">=</span><span class="st">"Wyprawy"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>most_active_of_interest <span class="op">=</span> df_acvitivy_interest.sort_values(by<span class="op">=</span><span class="st">"Wyprawy"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>display(most_active.head(<span class="dv">5</span>).style.hide(axis<span class="op">=</span><span class="st">"index"</span>))</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>most_active_employee <span class="op">=</span> most_active.iloc[<span class="dv">0</span>]</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Markdown z najlepszym pracownikiem pod względem aktywności ---</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>markmarkdown_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="ss">👨‍🚀 Najbardziej aktywnym pracownikiem okazał jest **</span><span class="sc">{</span>most_active_employee[<span class="st">'Imię'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>most_active_employee[<span class="st">'Nazwisko'</span>]<span class="sc">}</span><span class="ss">** o ID </span><span class="sc">{</span>most_active_employee[<span class="st">'ID'</span>]<span class="sc">}</span><span class="ss"> , który przysłużył nam się pracując jako **</span><span class="sc">{</span>most_active_employee[<span class="st">'Pozycja'</span>]<span class="sc">}</span><span class="ss">**. Liczba wycieczek, na które miał wpływ ten niesamowity pracownik wynosi **</span><span class="sc">{</span>most_active_employee[<span class="st">'Wyprawy'</span>]<span class="sc">}</span><span class="ss">**.</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>display(Markdown(markmarkdown_text))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_b8ca2" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_b8ca2_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Imię</th>
<th id="T_b8ca2_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Nazwisko</th>
<th id="T_b8ca2_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Pozycja</th>
<th id="T_b8ca2_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">ID</th>
<th id="T_b8ca2_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Wyprawy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_b8ca2_row0_col0" class="data row0 col0">Angelika</td>
<td id="T_b8ca2_row0_col1" class="data row0 col1">Szulczyk</td>
<td id="T_b8ca2_row0_col2" class="data row0 col2">Specjalista ds. bezpieczeństwa</td>
<td id="T_b8ca2_row0_col3" class="data row0 col3">388</td>
<td id="T_b8ca2_row0_col4" class="data row0 col4">37</td>
</tr>
<tr class="even">
<td id="T_b8ca2_row1_col0" class="data row1 col0">Ida</td>
<td id="T_b8ca2_row1_col1" class="data row1 col1">Bacik</td>
<td id="T_b8ca2_row1_col2" class="data row1 col2">Inspektor jakości</td>
<td id="T_b8ca2_row1_col3" class="data row1 col3">166</td>
<td id="T_b8ca2_row1_col4" class="data row1 col4">36</td>
</tr>
<tr class="odd">
<td id="T_b8ca2_row2_col0" class="data row2 col0">Przemysław</td>
<td id="T_b8ca2_row2_col1" class="data row2 col1">Mosiołek</td>
<td id="T_b8ca2_row2_col2" class="data row2 col2">Mechanik rakietowy</td>
<td id="T_b8ca2_row2_col3" class="data row2 col3">184</td>
<td id="T_b8ca2_row2_col4" class="data row2 col4">36</td>
</tr>
<tr class="even">
<td id="T_b8ca2_row3_col0" class="data row3 col0">Artur</td>
<td id="T_b8ca2_row3_col1" class="data row3 col1">Syldatk</td>
<td id="T_b8ca2_row3_col2" class="data row3 col2">Specjalista ds. bezpieczeństwa</td>
<td id="T_b8ca2_row3_col3" class="data row3 col3">162</td>
<td id="T_b8ca2_row3_col4" class="data row3 col4">36</td>
</tr>
<tr class="odd">
<td id="T_b8ca2_row4_col0" class="data row4 col0">Marika</td>
<td id="T_b8ca2_row4_col1" class="data row4 col1">Kunka</td>
<td id="T_b8ca2_row4_col2" class="data row4 col2">Mechanik rakietowy</td>
<td id="T_b8ca2_row4_col3" class="data row4 col3">208</td>
<td id="T_b8ca2_row4_col4" class="data row4 col4">35</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>👨‍🚀 Najbardziej aktywnym pracownikiem okazał jest <strong>Angelika Szulczyk</strong> o ID 388 , który przysłużył nam się pracując jako <strong>Specjalista ds. bezpieczeństwa</strong>. Liczba wycieczek, na które miał wpływ ten niesamowity pracownik wynosi <strong>37</strong>.</p>
</div>
</div>
<p>Mając informacje o tym kto w której kategorii wypadł najlepiej, chcemy zweryfikować te wyniki w kategorii przeciwnej. To oznacza, że najlepiej ocenianego zbadamy pod kątem jego aktywności, a najaktywniejszego pod kątem jego ocen.</p>
<div id="b2121ede" class="cell" data-execution_count="69">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ocena(percent):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> percent <span class="op">&gt;</span> <span class="dv">90</span>:</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"wyśmienity"</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> percent <span class="op">&gt;</span> <span class="dv">75</span>:</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"bardzo dobry"</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> percent <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"dobry"</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> percent <span class="op">&gt;</span> <span class="dv">25</span>:</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"umiarkowany"</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> percent <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"nie najlepszy"</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"słaby"</span>                </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>best_employee_activity <span class="op">=</span> df_acvitivy[df_acvitivy[<span class="st">"ID"</span>] <span class="op">==</span> best_employee[<span class="st">"ID"</span>]]</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>most_active_employee_rating <span class="op">=</span> avg_ratings_all[avg_ratings_all[<span class="st">"ID"</span>]<span class="op">==</span> most_active_employee[<span class="st">"ID"</span>]]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>df_acvitivy <span class="op">=</span> df_acvitivy.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> df_acvitivy.index[df_acvitivy[<span class="st">"ID"</span>] <span class="op">==</span> best_employee[<span class="st">"ID"</span>]]</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> position[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>  <span class="co"># +1 bo indeksy zaczynają się od 0</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(df_acvitivy)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>percent_rank <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> (rank <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (total <span class="op">-</span> <span class="dv">1</span>)) <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span>   <span class="dv">100</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>employee_rating <span class="op">=</span> df_acvitivy.loc[position[<span class="dv">0</span>]]</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>markmarkdown_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="ss">Najlepiej oceniany pracownik, **</span><span class="sc">{</span>best_employee[<span class="st">'Imię'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>best_employee[<span class="st">'Nazwisko'</span>]<span class="sc">}</span><span class="ss">**, wziął udział w </span><span class="sc">{</span>employee_rating[<span class="st">"Wyprawy"</span>]<span class="sc">}</span><span class="ss"> wyprawach, co jest więcej niż </span><span class="sc">{</span>percent_rank<span class="sc">:.1f}</span><span class="ss">% pracowników. Jest to </span><span class="sc">{</span>ocena(percent_rank)<span class="sc">}</span><span class="ss"> wynik.</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>display(Markdown(markmarkdown_text))</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>avg_ratings_all <span class="op">=</span> avg_ratings_all.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> avg_ratings_all.index[avg_ratings_all[<span class="st">"ID"</span>] <span class="op">==</span> most_active_employee[<span class="st">"ID"</span>]]</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> position[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>  <span class="co"># +1 bo indeksy zaczynają się od 0</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(df_acvitivy)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>percent_rank <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> (rank <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (total <span class="op">-</span> <span class="dv">1</span>)) <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span>   <span class="dv">100</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>employee_rating <span class="op">=</span> avg_ratings_all.loc[position[<span class="dv">0</span>]]</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>markmarkdown_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="ss">Najaktywniejszy pracownik, **</span><span class="sc">{</span>most_active_employee[<span class="st">'Imię'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>most_active_employee[<span class="st">'Nazwisko'</span>]<span class="sc">}</span><span class="ss">**, uzyskał Ocena </span><span class="sc">{</span>employee_rating[<span class="st">"Ocena"</span>]<span class="sc">}</span><span class="ss">, co jest wynikiem lepszym od </span><span class="sc">{</span>percent_rank<span class="sc">:.1f}</span><span class="ss">% pracowników. Jest to </span><span class="sc">{</span>ocena(percent_rank)<span class="sc">}</span><span class="ss"> wynik.</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>display(Markdown(markmarkdown_text))</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Najlepiej oceniany pracownik, <strong>Michał Apanowicz</strong>, wziął udział w 1 wyprawach, co jest więcej niż 1.4% pracowników. Jest to słaby wynik.</p>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Najaktywniejszy pracownik, <strong>Angelika Szulczyk</strong>, uzyskał Ocena 4.3, co jest wynikiem lepszym od 65.4% pracowników. Jest to dobry wynik.</p>
</div>
</div>
</section>
</section>
<section id="roczna-sezonowość-wypraw-i-incydentów." class="level2">
<h2 class="anchored" data-anchor-id="roczna-sezonowość-wypraw-i-incydentów.">Roczna sezonowość wypraw i incydentów.</h2>
<p>W tym podpunkcie będziemy chcieli zbadać dwie rzeczy, które mogą być ze sobą powiązane. Chcemy kiedy w trakcie roku występuje najwięcej lotów, czy są jakieś trendy lub sezonowość. Dokładnie to samo będziemy chcieli sprawdzić w kwestii incydentów, czy są okresy kiedy zdarzają się częściej?</p>
<div id="e13ec23d" class="cell" data-execution_count="70">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 1: Daty podróży ---</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT trip_id, departure_datetime FROM trips"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_trips <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>df_trips[<span class="st">'departure_datetime'</span>] <span class="op">=</span> pd.to_datetime(df_trips[<span class="st">'departure_datetime'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>df_trips[<span class="st">'year_month'</span>] <span class="op">=</span> df_trips[<span class="st">'departure_datetime'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">.</span>year<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>x<span class="sc">.</span>month<span class="sc">:02d}</span><span class="ss">"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>df_trips[<span class="st">'year'</span>] <span class="op">=</span> df_trips[<span class="st">'departure_datetime'</span>].dt.year</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>df_trips[<span class="st">'month'</span>] <span class="op">=</span> df_trips[<span class="st">'departure_datetime'</span>].dt.month</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>trip_counts <span class="op">=</span> df_trips[<span class="st">'month'</span>].value_counts().sort_index()</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: Daty incydentów ---</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT incident_id, datetime_occurred FROM incidents"</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>df_incidents <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>df_incidents[<span class="st">'datetime'</span>] <span class="op">=</span> pd.to_datetime(df_incidents[<span class="st">'datetime_occurred'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>df_incidents[<span class="st">'year_month'</span>] <span class="op">=</span> df_incidents[<span class="st">'datetime'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">.</span>year<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>x<span class="sc">.</span>month<span class="sc">:02d}</span><span class="ss">"</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>df_incidents[<span class="st">'year'</span>] <span class="op">=</span> df_incidents[<span class="st">'datetime'</span>].dt.year</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>df_incidents[<span class="st">'month'</span>] <span class="op">=</span> df_incidents[<span class="st">'datetime'</span>].dt.month</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>incidents_counts <span class="op">=</span> df_incidents[<span class="st">'month'</span>].value_counts().sort_index()</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>all_months <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>trip_counts <span class="op">=</span> trip_counts.reindex(all_months, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>incidents_counts <span class="op">=</span> incidents_counts.reindex(all_months, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(all_months))</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>df_plot <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Miesiąc"</span>: [<span class="ss">f"</span><span class="sc">{</span>m<span class="sc">:02d}</span><span class="ss">"</span> <span class="cf">for</span> m <span class="kw">in</span> all_months],</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Liczba wycieczek"</span>: trip_counts.values,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Liczba incydentów"</span>: incidents_counts.values</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Zmiana na long format (wymagane przez plotly.express do grouped bar chart)</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_plot.melt(id_vars<span class="op">=</span><span class="st">"Miesiąc"</span>, var_name<span class="op">=</span><span class="st">"Typ"</span>, value_name<span class="op">=</span><span class="st">"Liczba"</span>)</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Rysowanie wykresu</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>    df_melted,</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Miesiąc"</span>,</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Liczba"</span>,</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"Typ"</span>,</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>    barmode<span class="op">=</span><span class="st">"group"</span>,</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Porównanie liczby wycieczek i incydentów wg miesiąca"</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>fig.update_layout(xaxis_title<span class="op">=</span><span class="st">"Miesiąc"</span>, yaxis_title<span class="op">=</span><span class="st">"Liczba"</span>)</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="a747875e-19a8-4ba5-9646-135ad3e0ae90" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("a747875e-19a8-4ba5-9646-135ad3e0ae90")) {                    Plotly.newPlot(                        "a747875e-19a8-4ba5-9646-135ad3e0ae90",                        [{"alignmentgroup":"True","hovertemplate":"Typ=Liczba wycieczek\u003cbr\u003eMiesi\u0105c=%{x}\u003cbr\u003eLiczba=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Liczba wycieczek","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"Liczba wycieczek","offsetgroup":"Liczba wycieczek","orientation":"v","showlegend":true,"textposition":"auto","x":["01","02","03","04","05","06","07","08","09","10","11","12"],"xaxis":"x","y":[8,5,9,6,9,11,13,8,9,3,12,7],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"Typ=Liczba incydent\u00f3w\u003cbr\u003eMiesi\u0105c=%{x}\u003cbr\u003eLiczba=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Liczba incydent\u00f3w","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"Liczba incydent\u00f3w","offsetgroup":"Liczba incydent\u00f3w","orientation":"v","showlegend":true,"textposition":"auto","x":["01","02","03","04","05","06","07","08","09","10","11","12"],"xaxis":"x","y":[9,6,11,5,9,8,8,11,8,9,8,9],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Miesi\u0105c"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Liczba"}},"legend":{"title":{"text":"Typ"},"tracegroupgap":0},"title":{"text":"Por\u00f3wnanie liczby wycieczek i incydent\u00f3w wg miesi\u0105ca"},"barmode":"group"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('a747875e-19a8-4ba5-9646-135ad3e0ae90');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Na powyższym wykresie możemy zobaczyć obok siebie, jak często występowały loty i incydenty.</p>
</section>
<section id="czy-klienci-dokonują-płatności-za-przejazdy-z-wyprzedzeniem-czy-czekają-do-ostatniej-chwili" class="level2">
<h2 class="anchored" data-anchor-id="czy-klienci-dokonują-płatności-za-przejazdy-z-wyprzedzeniem-czy-czekają-do-ostatniej-chwili">Czy klienci dokonują płatności za przejazdy z wyprzedzeniem, czy czekają do ostatniej chwili?</h2>
<p>Interesuje nas prosta, lecz ważna kwestia. Kiedy wpływają zapłaty za wyprawę. Oczywiście dla nas najlepiej byłoby, gdyby klient wypłacał pieniądze jak najwcześniej. Chcemy zbadać, czy dużo klientów ociąga się z płatnością. Może potrzebne będzie pogonienie ich lub nałożenie kar?</p>
<div id="597f8abb" class="cell" data-execution_count="71">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="st">    ts.client_id,</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="st">    ts.trip_id,</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="st">    ts.transaction_date,</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="st">    t.departure_datetime,</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="st">    DATEDIFF(t.departure_datetime, ts.transaction_date) AS days_before_trip</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions ts</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN trips t ON ts.trip_id = t.trip_id</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="op">-</span><span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">365</span>]</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Po czasie'</span>, <span class="st">'0-3 dni'</span>, <span class="st">'4-7 dni'</span>, <span class="st">'8-14 dni'</span>, <span class="st">'15-30 dni'</span>, <span class="st">'31-90 dni'</span>, <span class="st">'91+ dni'</span>]</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'payment_window'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'days_before_trip'</span>], bins<span class="op">=</span>bins, labels<span class="op">=</span>labels)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> df[<span class="st">'payment_window'</span>].value_counts().sort_index()</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> summary.reset_index()</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>df_summary.columns <span class="op">=</span> [<span class="st">'Okno czasowe'</span>, <span class="st">'Liczba płatności'</span>]</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    df_summary,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'Okno czasowe'</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Liczba płatności'</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Kiedy klienci płacą za wycieczki?'</span>,</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'Okno czasowe'</span>: <span class="st">'Ile dni przed wyjazdem dokonano płatności'</span>}</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>fig.update_layout(xaxis_title<span class="op">=</span><span class="st">'Okno czasowe'</span>, yaxis_title<span class="op">=</span><span class="st">'Liczba płatności'</span>)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="563e8a95-0a3b-409a-afd2-6171c0d906ee" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("563e8a95-0a3b-409a-afd2-6171c0d906ee")) {                    Plotly.newPlot(                        "563e8a95-0a3b-409a-afd2-6171c0d906ee",                        [{"alignmentgroup":"True","hovertemplate":"Ile dni przed wyjazdem dokonano p\u0142atno\u015bci=%{x}\u003cbr\u003eLiczba p\u0142atno\u015bci=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["Po czasie","0-3 dni","4-7 dni","8-14 dni","15-30 dni","31-90 dni","91+ dni"],"xaxis":"x","y":[21,109,151,239,505,1626,2312],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Okno czasowe"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Liczba p\u0142atno\u015bci"}},"legend":{"tracegroupgap":0},"title":{"text":"Kiedy klienci p\u0142ac\u0105 za wycieczki?"},"barmode":"relative"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('563e8a95-0a3b-409a-afd2-6171c0d906ee');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
<section id="ulubione-metody-płatności-naszych-klientów.-z-jakiego-źródła-wpływa-najwięcej-pieniędzy." class="level2">
<h2 class="anchored" data-anchor-id="ulubione-metody-płatności-naszych-klientów.-z-jakiego-źródła-wpływa-najwięcej-pieniędzy.">Ulubione metody płatności naszych klientów. Z jakiego źródła wpływa najwięcej pieniędzy.</h2>
<p>W tym podpunckcie zbadamy ważną kwestię finansową. Chcemy poznać preferencje płatnicze naszych klientów. To da nam informacje o tym, ile pieniędzy jest przesyłanych danym sposobem płatności. Będziemy wtedy wiedzieć, czy może warto będzie zainwestować w to, aby korzystanie z niego było prostsze i bardziej opłacalne.</p>
<div id="7a84f55e" class="cell" data-execution_count="72">
<details class="code-fold">
<summary>Kod</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="st">    payment_method,</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(*) AS total_transactions,</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(amount) AS total_amount</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE status = 'completed'</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY payment_method</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY total_amount DESC</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>df_methods <span class="op">=</span> pd.read_sql_query(text(query), engine)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Krok 2: (opcjonalne) dodanie okna płatności, jeśli df i diff są zdefiniowane ---</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Zakładam, że zmienna `df` i kolumna `diff` (days_before_trip) są już wcześniej utworzone.</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="op">-</span><span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">365</span>]</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Po czasie'</span>, <span class="st">'0-3 dni'</span>, <span class="st">'4-7 dni'</span>, <span class="st">'8-14 dni'</span>, <span class="st">'15-30 dni'</span>, <span class="st">'31-90 dni'</span>, <span class="st">'91+ dni'</span>]</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'payment_window'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'days_before_trip'</span>], bins<span class="op">=</span>bins, labels<span class="op">=</span>labels)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">=</span><span class="dv">2</span>, cols<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    shared_xaxes<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    vertical_spacing<span class="op">=</span><span class="fl">0.15</span>,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    subplot_titles<span class="op">=</span>(</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"💰 Źródła największego przychodu wg metody płatności"</span>,</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"📊 Popularność metod płatności wg liczby użyć"</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Wiersz 1: Łączna kwota</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    go.Bar(</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df_methods[<span class="st">"payment_method"</span>],</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df_methods[<span class="st">"total_amount"</span>],</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Łączna kwota"</span>,</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span><span class="st">"skyblue"</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Wiersz 2: Liczba transakcji</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>    go.Bar(</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df_methods[<span class="st">"payment_method"</span>],</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df_methods[<span class="st">"total_transactions"</span>],</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Liczba transakcji"</span>,</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span><span class="st">"lightgreen"</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Ustawienia osi, tytułu itd.</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">700</span>,</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>    showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>    xaxis_tickangle<span class="op">=</span><span class="dv">45</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">"Metoda płatności"</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Kwota"</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"Liczba transakcji"</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="b976998e-d2fe-4de6-8c0a-6d26777eacb5" class="plotly-graph-div" style="height:700px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("b976998e-d2fe-4de6-8c0a-6d26777eacb5")) {                    Plotly.newPlot(                        "b976998e-d2fe-4de6-8c0a-6d26777eacb5",                        [{"marker":{"color":"skyblue"},"name":"\u0141\u0105czna kwota","x":["wire_transfer","paypal","crypto","credit_card"],"y":[11839403862.49,11612383091.93,11513119015.84,10932669710.22],"type":"bar","xaxis":"x","yaxis":"y"},{"marker":{"color":"lightgreen"},"name":"Liczba transakcji","x":["wire_transfer","paypal","crypto","credit_card"],"y":[1274,1271,1225,1184],"type":"bar","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"bgcolor":"white","angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"ternary":{"bgcolor":"white","aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"white","subunitcolor":"#C8D4E3","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"matches":"x2","showticklabels":false,"tickangle":45},"yaxis":{"anchor":"x","domain":[0.575,1.0],"title":{"text":"Kwota"}},"xaxis2":{"anchor":"y2","domain":[0.0,1.0],"title":{"text":"Metoda p\u0142atno\u015bci"}},"yaxis2":{"anchor":"x2","domain":[0.0,0.425],"title":{"text":"Liczba transakcji"}},"annotations":[{"font":{"size":16},"showarrow":false,"text":"\ud83d\udcb0 \u0179r\u00f3d\u0142a najwi\u0119kszego przychodu wg metody p\u0142atno\u015bci","x":0.5,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"\ud83d\udcca Popularno\u015b\u0107 metod p\u0142atno\u015bci wg liczby u\u017cy\u0107","x":0.5,"xanchor":"center","xref":"paper","y":0.425,"yanchor":"bottom","yref":"paper"}],"height":700,"showlegend":false},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b976998e-d2fe-4de6-8c0a-6d26777eacb5');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Skopiowano!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Skopiowano!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>